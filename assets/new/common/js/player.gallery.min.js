/* common */(function(){function k(c,d){if(b.length>0)return;b.push(c);var e;h[c]&&(e=h[c]),j.broadcast("playerError",{action:c,text:e,label:d,swfs:a})}function l(){var b=!0,g=0,h=null;for(var j in a){var l=a[j];if(document.body.contains(l))try{var n=l.ping(j);n&&(f=!0)}catch(o){b=!1,h=j}else i.deregisterSwf(j)}b?e=0:(e++,e>=d&&(e=0,clearInterval(c),m()?f?k("safariPowerSaver",h):k("flashNotResponding",h):k("flashNotResponding",h)),console.log("unresponsive flash player detected"))}function m(){var a=navigator.userAgent.toLowerCase(),b=/.+applewebkit.+version\/((\d|\.)*)\s*safari/,c=a.match(b),d;return c&&c.length>1?(d=parseFloat(c[1]),d>=6.1):!1}function n(){context.player.flashPlayerMonitor&&(d=context.player.flashPlayerMonitor.failedPingCountMax),g&&c==-1&&(c=setInterval(l,context.player.flashPlayerMonitor&&context.player.flashPlayerMonitor.monitorLoopDurationInMs||1e4))}function o(){g||(console.log("flash not installed"),k("noFlash",""))}var a={},b=[],c=-1,d=1,e=0,f=!1,g=isFlashInstalled(),h={noFlash:'It seems that you do not have Adobe Flash Player installed. In order to play music and videos on Myspace, Flash needs to be installed. Point your browser to <a href="http://get.adobe.com/flashplayer/" target="_blank">http://get.adobe.com/flashplayer/</a> to install Flash now.',flashOutOfDate:'Myspace requires a minimum flash version of {0} for your system in order to play music and videos. Point your browser to <a href="http://get.adobe.com/flashplayer/" target="_blank">http://get.adobe.com/flashplayer/</a> to update Flash now.',flashNotResponding:"There seems to be a problem with your Flash Player. If you see a message indicating that your browser is blocking the Adobe Flash plugin by default or for an upgrade, please click to allow the Flash Player to be enabled or upgraded for Myspace.com.",safariPowerSaver:"There seems to be a problem with an instance of the Adobe Flash Player in your browser. Starting with Safari 6.1, the Safari Power Saver will sometimes disable the player for content that you wish to view. To enable the player again, roll your mouse over the video player and click the Safari Power Saver bar that appears to re-enable the player."},i={swfResponsive:function(){f=!0},registerSwf:function(b){a[b.name]=b.swf,n()},deregisterSwf:function(b){a&&a[b]&&delete a[b]}},j=comm.own("playerMonitor",i);setTimeout(o,0)})();
(function(){var a=new CookieHelper("player"),b;b=embedSWF(config.urls.playerSwf,"playerSwf",$("#videoPlayer > div").get(0),{callback:"Myspace.Player"}),Myspace.Player={resume:function(){b.resumeCurrentTrack()},pause:function(){b.pauseCurrentTrack&&b.pauseCurrentTrack()},mute:function(c){return c==undefined&&(c=!a("mute")),a({mute:c}),c?b.setCurrentVolume(0):b.setCurrentVolume(a("volume")),c},volume:function(c){return c>1&&(c=1),a({volume:c,mute:!1}),b.setCurrentVolume(c),c},seek:function(a){b.setCurrentPlayTime(a)},load:function(c,d){if(!c)return;d=d||0,c.mediaType=="video"?c.isLiveStream?c.isCurrentlyAiring&&!c.isEnded&&b.loadLive(c):b.loadVideo({rtmpURL:c.streamUrl,timedTextUrl:c.timedTextUrl,preseek:d,autoPause:a("paused")}):b.loadSong({rtmpURL:c.streamUrl,preseek:d,autoPause:a("paused")})},loadAd:function(a,c,d,e,f,g){b.loadAd(a,c,d,e,f,g)},startAd:function(){b.startAd()},stopAd:function(){b.skipAd()},skipAd:function(){b.skipAd()},pauseAd:function(){a({paused:!0}),b.pauseAd()},resumeAd:function(){a({paused:!1}),b.resumeAd()},sendAdClickTracking:function(){b.sendAdClickTracking()},loadLive:function(a){b.loadLive(a)},changeLiveStreamPOV:function(a){b.loadLive(a)},unloadTrack:function(){b.unloadTrack()},activateClosedCaptions:function(a){b.activateClosedCaptioning(a)},swf:b}})();
(function(a,b){"use strict";var c=function(){this.$container=a("#videoPlayer"),this.width=302,this.height=170,this.previewWidth=207,this.previewHeight=113,this.liveStreamAutoplayHeight=228,this.wire(),this.visible=!1,this.loading=!1,this.closed=!1,this.alwaysHidden=!1,this.trackingCategory="videoplayer",this.timeout,this.dialogOpen=!1,this.isPreview=!1,this.isAd=!1,this.$adPlayBtn=this.$container.find(".ad-play-btn"),this.$adSkipBtn=this.$container.find(".ad-skip-btn")};c.prototype.wire=function(){var b=this;this.$container.on("click",function(c){var d=a(c.target).closest("[data-action]"),e=d.data("action");switch(e){case"close":b.hide(),b.closed=!0,b.track(b.trackingCategory,"Hide",context.pfc);break;case"expand":comm.send("player.nowPlaying",function(a){a.mediaItem&&a.mediaItem.mediaType==="video"&&(a.mediaItem.isLiveStream?comm.send("location.href",a.mediaItem.detailUrl):comm.send("videoLightbox.instance",function(c){b.hide(),b.track(b.trackingCategory,"Expand",context.pfc),c&&c.show(a.mediaItem,{continuePlay:!0})}))});break;case"click":b.$container.hasClass("ad")&&comm.send("player.adClick");break;case"pauseAd":return comm.send("player.playPause"),!1;case"skipAd":!d.is(":disabled")&&comm.send("player.next");break;default:}})},c.prototype.setVPos=function(b){var c=15;b||a("body").hasClass("queueOpen")||a("#drawer").hasClass("message open")?c+=a("#drawer").outerHeight():c+=a("#global").outerHeight(!0)+a("#links").outerHeight(!0),this.$container.css("bottom",c),this.movePageElements({bottom:c})},c.prototype.setSize=function(a,b){var c=a||this.isPreview?this.previewWidth:this.width,d=b||this.isPreview?this.previewHeight:this.$container.hasClass("autoplay")?this.liveStreamAutoplayHeight:this.height;this.$container.width(c).height(d)},c.prototype.movePageElements=function(b){var c=b.bottom!==""?parseInt(b.bottom)+parseInt(this.$container.height())+20:"";a("#popups").css("bottom",c)},c.prototype.show=function(){var a=this;this.setSize(),this.setVPos(),this.visible=!0,this.closed=!1,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){a.$container.addClass("open")},500)},c.prototype.handleShow=function(){var a=this;comm.send("player.nowPlaying",function(b){!a.isAd&&a.canShow(b)?(a.isPreview=b.mediaItem.mediaType=="audio",a.show(),a.track(a.trackingCategory,"Show",context.pfc)):a.isAd&&a.canShowAd(b)?(a.isPreview=!1,a.show()):a.hide()})},c.prototype.handleShowAd=function(){var a=this,b={mediaItem:{mediaType:"video",type:"video"}};a.canShowAd(b)?(a.isPreview=!1,a.show()):a.hide()},c.prototype.canShow=function(a){return!this.isVideoDetail()&&!this.isLightbox()&&!this.alwaysHidden&&!this.closed&&!this.dialogOpen&&typeof a.mediaItem!="undefined"&&(a.mediaItem.mediaType=="video"||a.mediaItem.videoId)&&(this.isActive()||a.mediaItem.mediaType=="audio")},c.prototype.canShowAd=function(a){return!this.isVideoDetail()&&!this.isLightbox()&&this.isActive()},c.prototype.hide=function(){this.visible=!1,this.$container.removeClass("open"),this.movePageElements({bottom:""}),this.timeout&&clearTimeout(this.timeout)},c.prototype.isVideoDetail=function(){return typeof context!="undefined"&&(context.pfc==="videodetail"||context.pfc==="livestreamdetail")},c.prototype.isLightbox=function(){var a=!1;return comm.send("videoLightbox.instance",function(b){a=Boolean(b&&b.isOpen)}),a},c.prototype.showLoading=function(){this.loading=!0,this.$container.addClass("loading")},c.prototype.hideLoading=function(){this.loading=!1,this.$container.removeClass("loading")},c.prototype.drawerToggled=function(a){this.visible&&!this.isVideoDetail()&&this.setVPos(a)},c.prototype.isActive=function(){try{return localStorage.activePlayer==scomm.hash}catch(a){}return!0},c.prototype.addPlayButton=function(a){var b=this.$container.children("div");b.find(".playBtn:not(.ad-play-btn)").remove(),b.append(play("video",a))},c.prototype.track=function(a,b,c){comm.send("track",new Tracking(a,b,c))},c.prototype.showPreview=function(a){a.mediaType=="video"&&(this.addPlayButton(a),this.$container.find("> div").css("background-image","url("+a.imageUrl+")"),this.$container.find(".playBtn").click(function(){return comm.send("queue.find.video",a),!1}),this.hideLoading(),this.handleShow(),this.setSize(this.previewWidth,this.previewHeight),this.$container.addClass("preview"))},c.prototype.removePreview=function(){this.$container.hasClass("preview")&&(this.$container.find("> div").css("background-image",""),this.$container.removeClass("preview"))},c.prototype.setLiveStreamAutoplayInfo=function(a){var b=new Date(a.startDate),c=b.format("mmm").toUpperCase(),d=b.getDate(),e=this.$container.find(".liveStreamInfo"),f=this;e.find(".date .day").text(d),e.find(".date .month").text(c),e.find(".title").text(a.title),e.on("click",function(){f.$container.find(".expand").click()})},c.prototype.toggleAdPlayPause=function(a){this.$adPlayBtn.removeClass("paused playing").addClass(a?"playing":"paused")},c.prototype.updateAdSkipping=function(a){isNaN(parseFloat(a.enableSkipAfter))?this.$container.removeClass("skippable"):(this.$container.addClass("skippable"),a.enableSkipAfter>0?this.$adSkipBtn.attr("disabled","disabled").find("em").text(" in "+Math.ceil(a.enableSkipAfter)):this.$adSkipBtn.removeAttr("disabled"))},b.VideoPlayer=new c,comm.listen("drawer.opened",function(){b.VideoPlayer.drawerToggled(!0)},!0),comm.listen("drawer.closed",function(){b.VideoPlayer.drawerToggled(!1)},!0),comm.listen("player.ended",function(a){a.mediaItem.mediaType=="video"&&!b.VideoPlayer.isVideoDetail()&&(comm.send("videoLightbox.hide",!0),b.VideoPlayer.hide())},!0),comm.listen("player.loaded",function(a){a.mediaItem.mediaType=="video"&&(b.VideoPlayer.hideLoading(),a.paused||b.VideoPlayer.handleShow(),comm.send("ads.contenttracker",{entityKey:a.mediaItem.entityKey}))},!0),comm.listen("player.paused",function(a){b.VideoPlayer.isAd&&b.VideoPlayer.toggleAdPlayPause()}),comm.listen("player.resumed",function(a){b.VideoPlayer.isAd?b.VideoPlayer.toggleAdPlayPause(!0):(a.mediaItem.mediaType=="video"||a.mediaItem.videoId)&&b.VideoPlayer.handleShow()},!0),comm.listen("player.loading",function(a){var c=b.VideoPlayer;c.$container.removeClass("autoplay"),a.mediaItem.mediaType=="video"?(!c.isVideoDetail()&&!c.isLightbox()&&(a.mediaItem.isLiveStream&&a.mediaItem.autoplay&&(c.$container.addClass("autoplay"),c.setLiveStreamAutoplayInfo(a.mediaItem)),c.setSize()),c.removePreview(),c.showLoading(),c.addPlayButton(a.mediaItem),c.isAd=!1):!c.isVideoDetail()&&!a.mediaItem.videoId&&c.hide()},!0),comm.listen("player.bufferStatus",function(a){var c=b.VideoPlayer;a?c.$container.addClass("buffering"):c.$container.removeClass("buffering")},!0),c.prototype.log=function(){console.log.apply(console,arguments)},comm.listen("player.adLoading",function(a){a.isVideo&&(b.VideoPlayer.handleShowAd(),b.VideoPlayer.$container.addClass("ad").removeClass("skippable"),b.VideoPlayer.isAd=!0,b.VideoPlayer.showLoading())},!0),comm.listen("player.adStarted",function(a){b.VideoPlayer.removePreview(),b.VideoPlayer.toggleAdPlayPause(!0),b.VideoPlayer.updateAdSkipping(a),a.isVideo?(comm.send("videoLightbox.instance",function(a){!b.VideoPlayer.visible&&!a.isOpen&&b.VideoPlayer.show()}),b.VideoPlayer.hideLoading()):b.VideoPlayer.hide()},!0),comm.listen("player.adRemainingTime",function(a){b.VideoPlayer.updateAdSkipping(a)},!0),comm.listen("player.adStopped",function(c){c.isVideo&&(b.VideoPlayer.$container.removeClass("ad"),b.VideoPlayer.isAd=!1,b.VideoPlayer.hideLoading(),a("#queue .list."+Cookies.player.values.mode+" li").length||b.VideoPlayer.hide())},!0),comm.listen("player.onClick",function(a){b.VideoPlayer.log("videoPlayer: player onClick, mediaType: "+a.mediaInfo.mediaType+", isAd: "+a.mediaInfo.isAd)},!0),comm.listen("player.mediaPlayModeChange",function(a){a.mediaPlayMode=="replay"?b.VideoPlayer.$container.find(".liveLabel").html("<i></i>Recorded"):a.mediaPlayMode=="live"||a.mediaPlayMode=="dvr"?b.VideoPlayer.$container.find(".liveLabel").html("<i></i>Live"):b.VideoPlayer.$container.find(".liveLabel").html("")},!0),comm.listen("player.liveEventEnded",function(){b.VideoPlayer.hideLoading()}),comm.listen("spaceway.page.complete",function(){b.VideoPlayer.handleShow()},!0),comm.listen("player.queueChanged",function(c){if(["queue","preview","liveStream"].indexOf(c.mode)){var d=a("#queue .list."+c.mode+" li");if(!d.length)if(b.VideoPlayer.isVideoDetail()&&c.mode!="liveStream")comm.send("location.href",b.videoReferrer||"/discover/videos");else if(c.mode!="liveStream"||!c.noHide){var c={};context.video&&context.video.isLiveStream&&(c.redirectUrl=context.video.artistProfileUrl),comm.send("videoLightbox.hide",c),b.VideoPlayer.hide()}}},!0),comm.listen("dialog.showing",function(a){b.VideoPlayer.dialogOpen=!0,b.VideoPlayer.hide()},!0),comm.listen("dialog.hiding",function(a){b.VideoPlayer.dialogOpen=!1,b.VideoPlayer.handleShow()},!0),comm.listen("player.videoPreview",function(a){b.VideoPlayer.showPreview(a)},!0)})(jQuery,window.Myspace=window.Myspace||{});
(function(a,b){"use strict";var c,d={modal:!1,continuePlay:!1,updateLocation:!0,showRightRail:!0},e=a(window),f=a("#footer"),g=a("#global",f).outerHeight()+a("#links",f).outerHeight(),h=function(a){if(c)return c;if(!(this instanceof h))return new h;this.player=a||b.VideoPlayer,this.playerCookie=new CookieHelper("player"),this.isOpen=!1,this.coverClass,this.playerClass,this.$expand=this.player.$container.find(".expandBtn"),this.$showCC=this.player.$container.find(".showCCBtn"),this.isExpanded=!1,this.queueEnded=!1,this.isLiveStream=!1,this.$rightRailContainer=this.player.$container.find(".videoRailContainer"),c=this},i={hide:function(a){if(!c.isExpanded&&a&&a.isDialogOpen)return;h().isExpanded?h().shrinkVideo():(parseInt(arguments[0])===27||isNaN(parseInt(arguments[0])))&&h().hide({hidePlayer:!1})},showUI:function(){h().showUI()},hideUI:function(){h().hideUI()},expandVideo:function(){h().expandVideo()},toggleClosedCaptions:function(){h().toggleClosedCaptions()},handleDialogs:function(a){var b=a.attr("id").toLowerCase(),c=!h().player.isAd;b==="photocarousellightbox"?h().hide({hidePlayer:c,leaveCover:!0}):["searchdialog","logindialog","loginprompt","superpostdialog","reportabusedialog","radiodialog"].indexOf(b)>-1?h().hide({hidePlayer:c,leaveCover:!1,canRedirect:!1}):b!=="confirmdialog"&&b!="linkembeddialog"&&h().hide({hidePlayer:c,leaveCover:!1})},handlePlayerLoading:function(a){var b=h();b.isLiveStream&&a.mode!=="liveStream"?b.hide({redirectUrl:a.mediaItem.sourceUrl||a.mediaItem.url||a.mediaItem.detailUrl}):a.mediaItem.mediaType!=="video"||b.queueEnded?b.hide():b.isOpen&&!b.player.isAd&&b.mediaItem!=a.mediaItem&&(b.updateMe(a.mediaItem),b.mediaItem=a.mediaItem)},handlePlayerLoaded:function(a){mediaItem&&a.mediaItem.timedTextUrl?(h().enableClosedCaptions(!0),h().activateClosedCaptions(h().playerCookie("ccOn"))):(h().enableClosedCaptions(!1),h().activateClosedCaptions(!1))},handleActivatedClosedCaptions:function(a){h().activateClosedCaptions(a)}};h.prototype.wire=function(){this.$expand.on("click",i.expandVideo),this.$showCC.on("click",i.toggleClosedCaptions),e.unbind("resize",this.resizeRightRail).bind("resize",this.resizeRightRail),context.video&&!context.video.isCurrentlyAiring&&!context.video.isEnded?comm.listen("liveStreamCounter.zero",function(){context.video.isCurrentlyAiring=!0,h().removeOffAir(),h().playVideo(context.video)}):context.video&&context.video.isEnded?(h().removeOffAir(),h().setEventEnded()):(h().removeOffAir(),h().removeEventEnded()),a("#videoPlayer .close-lightbox").on("click",i.hide),comm.listen("page.esc",i.hide),comm.listen("player.keyDown",i.hide),comm.listen("dialog.showing",i.handleDialogs),comm.listen("player.preloading",i.handlePlayerLoading),comm.listen("player.loading",i.handlePlayerLoading),comm.listen("player.loaded",i.handlePlayerLoaded),comm.listen("player.activatedClosedCaptions",i.handleActivatedClosedCaptions),comm.listen("queue.ended",function(){h().queueEnded=!0}),comm.listen("spaceway.page.loading",function(){h().hide({canRedirect:!1})}),comm.listen("player.liveEventEnded",function(){h().setEventEnded()})},h.prototype.unWire=function(){a("#videoPlayer .close-lightbox").off("click",i.hide),this.$expand.off("click",i.expandVideo),this.$showCC.off("click",i.toggleClosedCaptions),e.unbind("resize",this.resizeRightRail),comm.stopListening("page.esc",i.hide),comm.stopListening("player.keyDown",i.hide),comm.stopListening("dialog.showing",i.handleDialogs),comm.stopListening("player.loading",i.handlePlayerLoading),comm.stopListening("player.loaded",i.handlePlayerLoaded),comm.stopListening("player.activatedClosedCaptions",i.handleActivatedClosedCaptions)},h.prototype.updateUrl=function(a,b){var c=b||a.detailUrl;comm.send("location.href",{url:c})},h.prototype.updateMe=function(a){this.renderRightRail(a),this.enableClosedCaptions(a.timedTextUrl),this.activateClosedCaptions(this.playerCookie("ccOn")),this.updateLocation?this.updateUrl(a):this.updateLocation=!0},h.prototype.show=function(e,f){a.extend(this,d,f||{}),!this.player.isVideoDetail()&&!this.isOpen&&(b.videoReferrer=window.location.pathname);var g=a("#searchDialog"),h=this;if(e){this.isLiveStream=Boolean(e.isLiveStream),this.isLiveStream&&(this.renderPlayerUI(e),this.wireFlippers(),this.wirePOVs(),this.adjustLivestreamTimes());if(this.isOpen)comm.send("player.nowPlaying",function(a){a.mediaItem&&a.mediaItem.mediaType==="video"&&a.mediaItem.mediaId!==e.mediaId&&h.playVideo(e)});else if(!this.player.dialogOpen||g.hasClass("open")){g.removeClass("open"),this.isOpen=!0,this.playerClass="lightBox",this.coverClass="video",this.modal&&(this.playerClass+=" modal",this.coverClass+=" modal"),this.isLiveStream&&(this.showRightRail=!1,this.playerClass+=" live",this.coverClass+=" live"),this.player.$container.removeAttr("style").removeClass("tooltip").addClass(this.playerClass).css("opacity",.01),this.player.closed=!1,a("#lightboxCover").hide().addClass(this.coverClass).removeClass("hide").fadeIn(function(){h.player.$container.animate({opacity:1})}),this.wire();var i=function(){comm.send("player.nowPlaying",function(a){a.mediaItem&&a.mediaItem.mediaType=="video"&&a.mediaItem.mediaId==e.mediaId?h.updateMe(e):e.isLiveStream?(comm.send("liveStream.clear",{noHide:!0}),e.isCurrentlyAiring&&!e.isEnded?h.playVideo(e):(comm.send("liveStream.activate",!0),e.isEnded?h.setEventEnded():(h.setOffAir(e.backgroundImageUrl),comm.send("liveStreamCounter.init")))):h.playVideo(e)})};b.Player.ready?i():comm.listen("player.ready",i)}else c.playVideo(e)}else this.detailUrl&&!this.player.isVideoDetail()&&comm.send("location.href",this.detailUrl)},h.prototype.hide=function(c){if(this.isOpen){var d=this,e=c&&c.hidePlayer,f=c&&c.leaveCover,g=c&&c.redirectUrl,h=c&&c.canRedirect;this.isOpen=!1,this.player.$container.find(".dynamicUI").html(""),this.player.$container.removeAttr("style").removeClass(this.playerClass).addClass("tooltip"),this.player.hide(),this.player.setSize(),this.player.setVPos(),this.$showCC.hasClass("showCC")&&(this.enableClosedCaptions(!1),this.activateClosedCaptions(!1)),e!==!0&&this.player.handleShow(),f!==!0&&a("#lightboxCover").addClass("hide"),a("#lightboxCover").removeClass(d.coverClass).removeAttr("style"),this.unWire(),h!==!1&&(this.player.isVideoDetail()?comm.send("location.href",g||b.videoReferrer||context.video.artistEventsUrl||context.video.artistVideosUrl||context.video.videosHomeUrl):this.updateUrl(null,b.videoReferrer))}},h.prototype.expandVideo=function(){var a=this;this.player.$container.animate({opacity:.01},function(){a.player.$container.addClass("full"),a.player.$container.animate({opacity:1}),a.isExpanded=!0}),this.player.track(this.player.trackingCategory,"Expand Full Window",context.pfc)},h.prototype.toggleClosedCaptions=function(){comm.send("player.toggleClosedCaptions")},h.prototype.enableClosedCaptions=function(a){a?this.$showCC.addClass("showCC"):this.$showCC.removeClass("showCC")},h.prototype.activateClosedCaptions=function(b){var c="Closed Captioning is "+(b?"on":"off"),d="ccDescription",e=a("body");e.find('.tip[data-name="'+d+'"] .tip-inner').text(c),e.find('[data-tip-name="'+d+'"]').attr("data-original-title",c),b?this.$showCC.addClass("active"):this.$showCC.removeClass("active")},h.prototype.shrinkVideo=function(){var a=this;this.player.$container.animate({opacity:.01},function(){a.player.$container.removeClass("full"),a.player.$container.animate({opacity:1}),a.isExpanded=!1})},h.prototype.setOffAir=function(a){this.player.$container.addClass("offair"),this.player.$container.removeClass("eventEnded"),this.player.$container.children("div").css("background-image","url("+a+")")},h.prototype.removeOffAir=function(){this.player.$container.removeClass("offair"),this.player.$container.children("div").css("background-image","")},h.prototype.setEventEnded=function(){this.player.$container.removeClass("offair"),this.player.$container.addClass("eventEnded")},h.prototype.removeEventEnded=function(){this.player.$container.removeClass("eventEnded")},h.prototype.renderPlayerUI=function(b){var c=require("ejs").render(templates["areas/videos/views/shared/_videoPlayerUI"],{video:b}),d=play("video",b,"hidden"),e=this.player.$container.find(".dynamicUI");e.html("").append(c).append(d);var f=e.find("footer > div > time"),g=new Date(f.text());f.text(g.format?g.format("mmmm dd, h:MMtt Z"):g.toUTCString()),a.post("/ajax/connections/connectBtn",{entity:b,entityType:b.mediaType},function(c){if(c&&c.markup){var d=a(c.markup).attr("data-uid",b.uid);e.append(d),comm.send("page.changed",e)}}),comm.send("wireVideoShareButtons",e.find(".share"))},h.prototype.wirePOVs=function(){var b=this,c=b.player.$container.find(".dynamicUI"),d=c.find(".POVs");d.on("click","a",function(b){var d=a(b.target).closest("li"),e=c.find(".POVs > button > span"),f={povName:d.data("vpname"),povId:d.data("id")};return comm.send("player.changeLiveStreamPOV",f),e.text(f.povId),!1})},h.prototype.adjustLivestreamTimes=function(){var b=this,c=b.player.$container.find(".dynamicUI"),d=c.find(".liveStreamDrawer > ul > li");d.length>0&&d.each(function(){var b=a(this).find("time"),c=new Date(b.attr("startDate"));b.text(dateFormat(c,"mmm dd, h:MMtt"))})},h.prototype.wireFlippers=function(){var c=this;setTimeout(function(){a.each(a(c.player.$container.find(".flippers > ul")),function(a,c){new b.Flippers(c,{hide:function(a){a.addClass("disabled")},show:function(a){a.removeClass("disabled")},scrollToNextLi:!0,scrollIntervalDelay:100})});var d=c.player.$container.find(".dynamicUI"),e=d.find(".liveStreamDrawer");if(e.length>0)var f=e.find(".leftFlipper"),g=e.find(".rightFlipper"),h=new b.Flippers(e.find("ul"),{leftFlipper:f,rightFlipper:g})},500)},h.prototype.playVideo=function(a){var c=this,d=function(){c.isLiveStream?a.isCurrentlyAiring&&!a.isEnded?comm.send("liveStream.find.video",a):(comm.send("liveStream.find.video",a),comm.send("liveStream.activate"),comm.send("liveStreamCounter.init"),!a.isCurrentlyAiring&&!a.isEnded?(comm.send("liveStream.clearNoActivate"),c.removeEventEnded(),c.setOffAir(a.backgroundImageUrl)):a.isEnded&&(comm.send("liveStream.clearNoActivate"),c.setEventEnded())):comm.send("queue.find.video",a)};b.Player.ready?d():comm.listen("player.ready",function(){d()})},h.prototype.renderRightRail=function(c){var d={entityKey:c.entityKey,mediaId:c.mediaId},e=this;a.ajax({url:"/ajax/videos/rightRail/render",type:"POST",data:d}).done(function(a){e.$rightRailContainer.replaceWith(a),e.$rightRailContainer=e.player.$container.find(".videoRailContainer"),new b.RR(e.$rightRailContainer.find(".rr")[0]),comm.send("page.changed",e.$rightRailContainer),e.resizeRightRail()})},h.prototype.resizeRightRail=function(){c.$rightRailContainer.height(e.height()-g)},comm.listen("videoLightbox.instance",function(a){a(h())},!0),comm.listen("videoLightbox.show",function(a){h().show(a)},!0),comm.listen("videoLightbox.hide",function(a){h().hide(a)},!0)})(jQuery,window.Myspace=window.Myspace||{}),function(a){function b(b,c,d,e){var f=(a(window).width()-b)/2,g=(a(window).height()-c)/2,h="status=1,width="+b+",height="+c+",top="+g+",left="+f;window.open(d,e,h)}function c(c){c.on("click","button",function(){var d=a(this),e=d.data("service"),f={};switch(e){case"myspace":comm.send("superpost",{element:this,text:c.data("shareTitle")+" "+window.location.href});break;case"twitter":f.url=window.location.href,f.text=c.data("shareTitle"),b(575,275,"https://twitter.com/share?"+a.param(f),"twitter-share");break;case"facebook":f.u=window.location.href,b(626,436,"https://www.facebook.com/sharer/sharer.php?"+a.param(f),"facebook-share")}return!1})}comm.listen("wireVideoShareButtons",function(a){c(a)},!0)}(jQuery);
var Queue=function(a,b){function h(a){var b=l(a);return b.length&&(f.removeClass("selected"),f=b.addClass("selected")),b}function i(a,c){m("load",$.extend(c,{$li:a,mediaItem:k(a),mode:b}))}function j(a,b){var c=[];return a.forEach(function(a,d){try{var e=document.createElement("ul");e.innerHTML=require("ejs").render(templates["common/views/footer/_queueItem"],{queueItem:a}),e.children[0].setAttribute("data-order",b+d),c.push(e.children[0])}catch(f){}}),$(c)}function k(a){var b=a.find(".playBtn"),c;return b.length&&(c=objectify(b)),c}function l(a){if(typeof a=="object"){if(a instanceof $&&a.is("li"))return a;if(a instanceof Node&&a.tagName=="LI")return $(a)}else if(typeof a=="string")return c.filter(a);return $()}function m(a,b){comm.send("player."+a,b)}function n(a){p(a),s()}function o(){s()}function p(a){e=d.find("li"),c.listId=undefined,m("queueChanged",$.extend({mode:b},a))}function q(){e=d.find("li"),e.each(function(a,b){b.setAttribute("data-order",a)})}function r(a,c,d){scomm.send("queue."+b+"."+a,c,d)}function s(a){r("setHtml",d.html(),a)}function t(a){d.html(a),d.find(".connectButton").removeAttr("data-popover-initialized"),f=d.find("li.selected"),p()}function u(a){var b=[];e.each(function(a,c){b.push(parseInt(c.getAttribute("data-order")))}),r("setOrder",b,a)}function v(a){e.each(function(b,c){c.setAttribute("data-order",a[b])})}function w(a){r("setSelected",c.position,a)}function x(a){h('li[data-order="'+a+'"]')}var c=this,d=$(a),e=d.find("li"),f=d.find("li.selected"),g;q(),this.listId,this.removed=$.noop,this.play=$.noop,this.expand=$.noop,Object.defineProperty(this,"mode",{get:function(){return b}}),Object.defineProperty(this,"$ul",{get:function(){return d}}),Object.defineProperty(this,"$lis",{get:function(){return e}}),Object.defineProperty(this,"$selected",{get:function(){return f}}),Object.defineProperty(this,"$previous",{get:function(){return d.find('li[data-order="'+(this.position-1)+'"]')}}),Object.defineProperty(this,"$next",{get:function(){return d.find('li[data-order="'+(this.position+1)+'"]')}}),Object.defineProperty(this,"$first",{get:function(){return d.find('li[data-order="0"]')}}),Object.defineProperty(this,"$last",{get:function(){return d.find('li[data-order="'+(this.length-1)+'"]')}}),Object.defineProperty(this,"length",{get:function(){return e.length}}),Object.defineProperty(this,"position",{get:function(){return parseInt(f.attr("data-order"))}}),Object.defineProperty(this,"media",{get:function(){var a=[];return e.each(function(b,c){a.push(k($(c)))}),a}}),this.set=function(a){var b=j(a,0);return f=$(),d.empty().append(b),n(),g&&c.shuffle(),b},this.insert=function(a){if(!this.$next.length)return c.append(a);var b=j(a,this.position+1),d=b.length;return e.each(function(a,b){var e=parseInt(b.getAttribute("data-order"));e>c.position&&b.setAttribute("data-order",e+d)}),b.insertAfter(f),n(),b},this.append=function(a){var b=j(a,c.length);return d.append(b),n(),b},this.remove=function(a,d){var e=l(a);if(e.remove().length){n(),g?c.shuffle():c.unshuffle();if(e.hasClass("selected"))if(c.length==0)f=$(),m("unload",b);else{var h=parseInt(e.attr("data-order"));h==c.length?c.previous(d):c.select('li[data-order="'+h+'"]',d)}c.removed(e)}},this.clear=function(a){e.length&&(d.empty(),n(a),m("unload",b))},this.select=function(a,b){var c=h(a);return c.length&&(w(),i(c,b)),c},this.play=function(a,b){return this.select(a,$.extend(b,{play:!0}))},this.replay=function(a){return this.play(c.$selected,a)},this.previous=function(a){return this.select(this.$previous,a)},this.next=function(a){return this.select(this.$next,a)},this.first=function(a){return this.select(this.$first,a)},this.last=function(a){return this.select(this.$last,a)},this.error=function(){f.hasClass("error")||(f.append('<div class="error"><i class="error_24"></i><span>Error Playing</span></div>'),setTimeout(function(){f.addClass("error")},50))},this.filter=function(a){return d.find(a).closest("li")},this.shuffle=function(){var a=[],b=!!f.length;b||a.push(0);for(var c=1;c<this.length;c++)a.push(c);for(var d,h,c=a.length;c;d=parseInt(Math.random()*c),h=a[--c],a[c]=a[d],a[d]=h);e.each(function(c,d){d.setAttribute("data-order",b&&d.className.indexOf("selected")>-1?0:a.shift())}),u(),g=!0},this.unshuffle=function(){q(),u(),g=!1},this.resetOrder=function(){q()},this.changed=function(a){n(a)},this.updated=function(){o()},this.sync=function(a){r(a,scomm.hash,localStorage.activePlayer)};var y={syncHtml:s,setHtml:t,syncOrder:u,setOrder:v,syncSelected:w,setSelected:x};scomm.add(function(a,c,d){var e=a.split("."),f=e[0],g=e[1],a=e[2];if(f!="queue"||g!=b)return;y[a](c)})};
(function(){function d(){var c=a.select('[data-sequence-id="'+b("sequenceId")+'"]',{resuming:!0,time:b("currentTime"),streamStartDateTime:b("streamStartDateTime"),playLinkedVideo:!1});c.length||(a.length?a.first({resuming:!0}):r("load",{mode:"queue"}))}function e(){return a.$selected.next().find(".playBtn").attr("data-sequence-id")}function f(a,b,c){var d={media:[]},c=e();return b.forEach(function(a){d.media.push({mediaType:a.mediaType,mediaId:a.mediaId,releaseId:a.mediaReleaseId,influencerId:a.influencerId,entityKey:a.entityKey,sourceEntityKey:a.sourceEntityKey||""})}),a=="insert"&&(isNaN(c)?a="append":d.beforeSequenceId=c),{action:a,data:d}}function h(a,b,c){g.push({action:a,media:b,play:c}),g.length==1&&i(g[0])}function i(c){function j(){var c=f(d,e);p(c.action,c.data,function(c){if($.isArray(c)){var d;j.each(function(a,b){var e=c[a],f=b.querySelector(".playBtn"),g=b.querySelector(".connectButton");g&&(e.isConnected?g.className.indexOf("connected")==-1&&(g.className+=" connected"):g.className.indexOf("connected")>-1&&(g.className=g.className.replace("connected","").replace("  "," ").trim()),g.setAttribute("data-is-connected",!!e.isConnected)),f&&(f.setAttribute("data-sequence-id",e.sequenceId),f.setAttribute("data-is-connected",!!e.isConnected),e.sourceName&&e.sourceUrl&&(f.setAttribute("data-source-name",e.sourceName),f.setAttribute("data-source-url",e.sourceUrl)),b.className.indexOf("selected")>-1&&(d=objectify($(f))))}),a.updated(),d&&(delete d.allowedPlay,r("state",{mediaItem:d})),b({sequenceId:a.$selected.find(".playBtn").attr("data-sequence-id")})}},undefined,function(){g.shift(),g.length&&i(g[0])});var j=a[c.action](e);h&&a.play(c.action=="set"?'[data-order="0"]':j.first())}var d=c.action,e=c.media,h=c.play;h==undefined&&(h=!a.length),a.$lis.length+e.length>context.playlistMaxItems?l(function(){d="set",j()}):j()}function j(a,b){var c={},d=e();return b.albumId?c.albumId=b.albumId:b.playlistId&&(c.playlist={playlistId:b.playlistId,profileId:b.profileId}),a=="insert"&&(isNaN(d)?a="append":c.beforeSequenceId=d),b.influencerId&&(c.influencerId=b.influencerId),{action:a,data:c}}function k(b,c,d){function f(){p(e.action,e.data,function(b){if($.isArray(b)){var c=a[e.action](b);d&&a.play(e.action=="set"?'[data-order="0"]':c.first())}q("loaded")},function(a){a.status==429?l(function(){delete e.beforeSequenceId,e.action="set",f()},function(){q("loaded")}):q("loaded")})}d=d||!a.length,q("loading",c);var e=j(b,c);f()}function l(a,b){Myspace.Confirm({text:"You have too many items in your queue. Do you want to clear your queue and continue?",yes:{text:"Yes",onClick:a},no:{text:"No",onClick:b}})}function m(c){var d=objectify(c.find(".playBtn")),e={mediaType:d.mediaType,mediaId:d.mediaId,sequenceId:d.sequenceId},f=c.next().find(".playBtn").attr("data-sequence-id");f&&(e.beforeSequenceId=f),p("move",{media:e}),b("shuffled")||a.resetOrder(),a.changed()}function n(){}function p(a,b,c,d,e){$.save({url:"/ajax/music/queue/"+a,data:b,success:c,error:d,complete:e})}function q(a,b){c.broadcast(a,b),scomm.send&&scomm.send("queue.broadcast."+a,b)}function r(a,b){comm.send("player."+a,b)}function s(a,b){comm.send("track",new Tracking("playerQueue",a,b))}var a=new Queue("#queue .list.queue","queue"),b=new CookieHelper("player");a.$ul.on("click",function(b){var c=$(b.target),d=c.closest("li"),e=d.find(".playBtn"),f=e.attr("data-type");if(!d.length||c.is("a")&&(f!="video"||!c.parent().is("h6")))return;var g=c.closest(".connectButton");if(g.length){s("connect",g.hasClass("connected")?"disconnect":"connect");return}if(c.is("a")&&f==="video"||c.hasClass("expand")){var h=objectify(e);comm.send("videoLightbox.instance",function(a){a&&a.show(h)}),c.hasClass("expand")&&s("expand")}else if(c.hasClass("remove"))a.remove(d,{playLinkedVideo:!1}),s("remove",f);else if(d.hasClass("selected")){var i=e.hasClass("playing")?"pause":"resume";r(i,f),s(i,f)}else s("play",f),a.play(d,{playLinkedVideo:!1});return!1});var c=comm.own("queue",{set:function(b){var c=b.selected?'[data-uid="'+b.selected.uid+'"]':"",d=c&&a.filter(c).length>0;if(!d||b.listId!=a.listId)h("set",b.media,!1),a.listId=b.listId;c?a.play(c):a.first({play:!0})},"play.song":function(a){h("insert",[a],!0)},"insert.song":function(a){h("insert",[a])},"append.song":function(a){h("append",[a])},"find.video":function(b){var c=a.filter('[data-media-id="'+b.mediaId+'"]');c.length?a.play(c):this["play.video"](b)},"play.video":function(a){h("insert",[a],!0)},"insert.video":function(a){h("insert",[a])},"append.video":function(a){h("append",[a])},"set.album":function(a){k("set",a,!0)},"play.album":function(a){k("insert",a,!0)},"insert.album":function(a){k("insert",a)},"append.album":function(a){k("append",a)},"set.mixtape":function(a){k("set",a,!0)},"play.mixtape":function(a){k("insert",a,!0)},"insert.mixtape":function(a){k("insert",a)},"append.mixtape":function(a){k("append",a)},clear:function(){a.clear(),b({sequenceId:-1}),p("clear")},previous:function(){if(b("shuffled")){this.next();return}var c=!a.previous().length;c&&(b("repeat")!="off"?a.last():a.replay())},next:function(){var c=!a.next().length;c&&(b("shuffled")==1?(a.shuffle(),a.next()):a.first({paused:b("repeat")=="off"}))},end:function(){if(b("repeat")=="one")a.replay();else{var d=!a.next().length;d&&(c.broadcast("ended"),a.first({paused:b("repeat")=="off"}))}},shuffle:function(b){b?a.shuffle():a.unshuffle()},error:function(b){a.error(),r("pause")},list:function(b){b({$lis:a.$lis,listId:a.listId})},media:function(b){b(a.media)},activate:function(){d()},remove:function(b){a.remove(b)}});comm.listen({player:{"+sync":function(){a.sync("syncOrder")},"+activate":function(){b("mode")=="queue"&&d()},"+activated":function(){b("shuffled")&&a.shuffle()},"+loading":function(a){a.mode=="queue"&&localStorage.activePlayer==scomm.hash&&b({sequenceId:a.mediaItem.sequenceId,currentTime:a.time})}}}),a.removed=function(c){a.length==0&&b("mode")=="queue"&&r("pause");var d=c.find(".playBtn");p("remove",{media:{mediaType:d.attr("data-media-type"),mediaId:d.attr("data-media-id"),sequenceId:d.attr("data-sequence-id")}})};var g=[];if(window.context.features.isPlayerQueueSortable){var o={$elem:a.$ul,activeClass:"dragee",ignoreSelectors:".util",hoverSupressorClass:"transp",dragText:n,dragStart:function(a,b){b.parent().addClass("dragged")},dragEnd:function(a,b){b.parent().removeClass("dragged")},drop:function(a,b){m(b)}};new Myspace.SortManager(o)}scomm.add(function(a,b,d){var e=a.split("."),f=e[0],a=e[1],g=e[2];if(f!="queue")return;switch(a){case"broadcast":c.broadcast(g,b);break;default:comm.send("queue."+a,b)}})})();
(function(){function e(b){var c=!a.next().length;c?g(!0,b):a.$next.length||g(!1,b)}function f(){var c=a.select('[data-media-id="'+b("radioMediaId")+'"]',{time:b("radioCurrentTime"),streamStartDateTime:b("radioStreamStartDateTime")});c.length||(a.length?a.first():comm.send("queue.activate"))}function g(b,d){c=j(d,function(c){k("allowSkips",c.allowSkips),$.isArray(c.songs)&&c.songs.length?(a.append(c.songs),b&&a.next(),a.$next.length||g()):h()},function(){h()})}function h(){Myspace.Error({text:"Oops, we couldn't retrieve songs for this station at this time. Please try again later.",yes:{text:"OK"},no:!1})}function i(a,b){comm.send("player."+a,b)}function j(a,c,d){return $.save({url:"/ajax/music/radio",data:$.extend({radioEntity:b("radioEntity"),max:1},a),success:c,error:d})}function k(a,b){d.broadcast(a,b),scomm.send&&scomm.send("radio.broadcast."+a,b)}function l(a,b,c){comm.send("track",new Tracking(a,b,c))}var a=new Queue("#queue ul.list.radio","radio"),b=new CookieHelper("player"),c;a.$ul.on("click",function(a){var b=$(a.target),c=b.closest("li");if(!c.length||b.is("a"))return;var d=b.closest(".connectButton");if(d.length){l("playerQueue","connect",d.hasClass("connected")?"disconnect":"connect");return}if(c.hasClass("selected")){var e=c.find(".playBtn"),f=e.hasClass("playing")?"pause":"resume",g=e.attr("data-type");i(f),l("playerQueue",f,g)}return!1});var d=comm.own("radio",{activate:function(){f()},start:function(d){var e=d.radioEntity||d.radioStationEntityKey||d.genreRadioStationEntityKey||"";if(!Myspace.User.isLoggedIn){comm.send("login.prompt",{action:"playRadio",object:e});return}b({radioEntity:e,radioCurrentTime:0}),k("starting",d),c&&c.abort(),c=j({max:2},function(c){c.radioEntity&&(d.radioEntity=c.radioEntity,b({radioEntity:c.radioEntity})),$.isArray(c.songs)&&c.songs.length?(a.set(c.songs),a.first({play:!0})):h(),k("started",d),k("allowSkips",c.allowSkips)},function(){h(),k("started",d)})},clear:function(){a.$selected.prevAll().remove(),a.changed(),a.unshuffle()},next:function(){comm.send("player.nowPlaying",function(a){e({skipMediaId:a.mediaItem.mediaId,skipMediaTotalLengthSeconds:a.mediaItem.duration,skipSeconds:a.time})})},end:function(){e()},error:function(){a.error(),i("pause")},media:function(b){b(a.media)},allowSkips:function(a){k("allowSkips",a)}});comm.listen({player:{"+sync":function(c){b("mode")=="radio"&&a.sync("syncHtml"),scomm.send("radio.sync",undefined,localStorage.activePlayer)},"+activate":function(){b("mode")=="radio"&&f()},"+loading":function(a){a.mode=="radio"&&localStorage.activePlayer==scomm.hash&&b({radioMediaType:a.mediaItem.mediaType,radioMediaId:a.mediaItem.mediaId,radioCurrentTime:a.time})}}}),scomm.add(function(a,b,c){var e=a.split("."),f=e[0],a=e[1],g=e[2];if(f!="radio")return;switch(a){case"broadcast":d.broadcast(g,b);break;case"sync":scomm.send("radio.broadcast.allowSkips",$("#footer").hasClass("allowSkips"),c);break;default:comm.send("radio."+a,b)}})})();
(function(){var a=new Queue("#queue .list.preview","preview"),b=new CookieHelper("player");a.$ul.on("click",function(b){var c=$(b.target),d=c.closest("li");if(!d.length||c.is("a")||c.closest(".connectButton").length)return;if(c.hasClass("expand")){var e=objectify(d.find(".playBtn"));comm.send("videoLightbox.instance",function(a){a&&a.show(e)})}else if(c.hasClass("remove"))a.remove(d);else if(d.hasClass("selected")){var f=d.find(".playBtn").hasClass("playing");player(f?"pause":"resume")}else a.play(d);return!1});var c=comm.own("preview",{set:function(b){b.listId!=a.listId&&(a.set(b.media),a.listId=b.listId),a.play('[data-uid="'+b.selected.uid+'"]')},"play.song":function(b){a.play(a.insert([b]))},"find.video":function(b){var c=a.filter('[data-media-id="'+b.mediaId+'"]');c.length?a.play(c):this["play.video"](b)},"play.video":function(b){a.play(a.insert([b]))},previous:function(){var b=!a.previous().length;b&&a.replay()},next:function(){var b=!a.next().length;b&&a.first({paused:!0})},end:function(){var b=!a.next().length;b&&(c.broadcast("ended"),a.first({paused:!0}))}});comm.listen({player:{"+sync":function(){b("mode")=="preview"&&a.sync("syncHtml")},"+activate":function(){b("mode")=="preview"&&(a.$selected.length?a.play(a.$selected):comm.send("queue.activate"))}}}),a.removed=function(){a.length==0&&b("mode")=="preview"&&comm.send("queue.activate")}})();
(function(){function d(b){a.length?a.first():b?comm.send("player.load",{mode:"liveStream"}):comm.send("queue.activate")}function e(a,b){comm.send("player."+a,b)}var a=new Queue("#queue .list.liveStream","liveStream"),b=new CookieHelper("player");a.$ul.on("click",function(b){var c=$(b.target),d=c.closest("li");if(!d.length||c.is("a")||c.closest(".connectButton").length)return;if(c.hasClass("expand"))Myspace.VideoPlayer.isVideoDetail()||comm.send("location.href",d.find(".playBtn").data("detailUrl"));else if(c.hasClass("remove"))a.remove(d);else if(d.hasClass("selected")){var f=d.find(".playBtn").hasClass("playing");e(f?"pause":"resume")}else a.play(d);return!1});var c=comm.own("liveStream",{set:function(b){b.listId!=a.listId&&(a.set(b.media),a.listId=b.listId),a.play('[data-uid="'+b.selected.uid+'"]')},"find.video":function(b){var c=a.filter('[data-media-id="'+b.mediaId+'"]');c.length?a.play(c):this["play.video"](b)},"play.video":function(b){a.play(a.insert([b]))},previous:function(){var b=!a.previous().length;b&&a.replay()},next:function(){var b=!a.next().length;b&&a.first({paused:!0})},end:function(){var b=!a.next().length;b&&(c.broadcast("ended"),a.first({paused:!0}))},activate:function(a){d(a)},clear:function(b){a.clear(b)}});comm.listen({player:{"+sync":function(){b("mode")=="liveStream"&&a.sync("syncHtml")},"+activate":function(){b("mode")=="liveStream"&&d()}}}),a.removed=function(){a.length==0&&b("mode")=="liveStream"&&comm.send("queue.activate")}})();
(function(){function setMode(a){a&&a!=cookie("mode")&&(cookie({mode:a}),broadcast("mode",a))}function load(a){if(a){Myspace.User.isLoggedIn||delete a.mediaItem.streamUrl;function b(){function b(){loading=!0,broadcast("loading",getState());if(mediaItem.isAuthorized){if(!mediaItem.isLiveStream)player.load(mediaItem,a.time);else if(mediaItem.isLiveStream&&mediaItem.isCurrentlyAiring&&!mediaItem.isEnded){var b=getLiveStreamObject(mediaItem);player.load(b,a.time)}}else switchboard.pause();mediaItem.video&&broadcast("videoPreview",mediaItem.video)}mediaItem&&(a.mediaItem.isAuthorized&&!mediaItem.isAuthorized&&hideLoginPrompt(),broadcast("stopped",getState())),setMediaItem(a.mediaItem),mediaItem.streamStartDateTime=a.streamStartDateTime,a.paused!=undefined&&cookie({paused:a.paused}),a.play!=undefined&&cookie({paused:!a.play}),setTime(a.time||0),tsl=0,ad.isPlaying?(onAdStop=b,broadcast("preloading",getState()),ad.skipped=!0,cookie("paused")||switchboard.resume()):getAdsEnabled()&&!context.adsProhibited&&!mediaItem.adsProhibited&&(!Number(cookie("at"))||mediaItem.mediaType=="video"&&mediaItem.isPremium)&&!mediaItem.isLiveStream&&(mediaItem.mediaType=="audio"||context.adPlayer)&&adMediaType&&cookie("mode")!="preview"&&cookie("mode")!="liveStream"?(onAdStop=b,broadcast("preloading",getState()),cookie("paused")?onResume=loadAd:loadAd()):(onAdStop=undefined,b())}a.mediaItem.streamUrl||a.mode=="liveStream"?(a.mediaItem.isAuthorized=!0,b()):$.save({url:"/ajax/streamurl",data:{mediaType:a.mediaItem.mediaType,mediaId:a.mediaItem.mediaId},loginPromptSettings:{action:"play",object:a.mediaItem.entityKey},success:function(b){a.mediaItem.streamUrl=b,a.mediaItem.isAuthorized=!0},error:a.resuming?function(){a.play=!1}:undefined,errorCallback:function(){a.play=!1},complete:function(){b()}})}}function volume(a){player.volume(a),_comm.broadcast("volumeChanged",a)}function mute(a){var b=player.mute(a);_comm.broadcast(b?"muted":"unmuted")}function toggleClosedCaptions(){var a=!cookie("ccOn");cookie({ccOn:a}),player.activateClosedCaptions(a),_comm.broadcast("activatedClosedCaptions",a)}function getTime(){switch(cookie("mode")){case"radio":return cookie("radioCurrentTime");case"queue":return cookie("currentTime");case"preview":return previewCurrentTime;case"liveStream":return liveStreamCurrentTime}return 0}function setTime(a){switch(cookie("mode")){case"radio":cookie({radioCurrentTime:a});break;case"queue":cookie({currentTime:a});break;case"preview":previewCurrentTime=a;break;case"liveStream":liveStreamCurrentTime=a}}function getStreamStartDateTime(){switch(cookie("mode")){case"radio":return cookie("radioStreamStartDateTime");case"queue":return cookie("streamStartDateTime");case"preview":return previewStreamStartDateTime;case"liveStream":return liveStreamStartDateTime}}function setStreamStartDateTime(a){mediaItem.streamStartDateTime=a;switch(cookie("mode")){case"radio":cookie({radioStreamStartDateTime:a});break;case"queue":cookie({streamStartDateTime:a});break;case"preview":previewStreamStartDateTime=a;break;case"liveStream":liveStreamStartDateTime=a}}function mode(a,b){comm.send(cookie("mode")+"."+a,b)}function broadcast(a,b){_comm.broadcast(a,b),send("broadcast."+a,b)}function getState(a){return $.extend({mode:cookie("mode"),mediaItem:mediaItem,paused:cookie("paused"),time:getTime(),tsl:tsl},a)}function getVideo(a,b,c){videoRequest=$.save({url:"/ajax/videos",data:{videoIds:[a]},success:function(a){$.isArray(a)&&a.length?$.isFunction(b)&&b(a[0]):$.isFunction(c)&&c()},error:function(){$.isFunction(c)&&c()}})}function loadAd(a){broadcast("bufferStatus",!1);if(!player||!player.swf){broadcast("adStopped",{isVideo:!0});return}player.swf.pauseCurrentTrack();var b=a&&a.locationId?a.locationId:0,c=adMediaType=="video"&&focused!==!1,d=Number.NaN,e=Number.NaN;mediaItem&&(d=mediaItem.artistId,e=mediaItem.mediaReleaseId);if(b>0)player.loadAd(0,context.ads.msd,c,b,d,e);else{var f=a&&a.genreId?a.genreId:mediaItem.genreId;player.loadAd(f,context.ads.msd,c,0,d,e)}}function stopAd(){player.isPlaying?player.stopAd():send("stopAd")}function setMediaItem(a){mediaItem&&(prevMediaItem=mediaItem),mediaItem=a,generateAdMediaType()}function generateAdMediaType(){var a=mediaItem.mediaType,b;prevMediaItem?b=prevMediaItem.mediaType:b=a;var c=b+"_"+a,d=context.adPlayer?context.adPlayer.videoAdsRatio[c]:0;adMediaType=Math.random()>d?"audio":"video",adMediaType=="audio"&&(b=="video"||a=="video")&&(adMediaType=null),log("Video ads ratio: "+d+", next ad type: "+adMediaType)}function getAdsFirstAdAfter(){return context.adPlayer?context.adPlayer.firstAdAfter:context.audioAds.firstAdAfter}function getAdsSubsequentAdsAfter(){return context.adPlayer?context.adPlayer.subsequentAdsAfter:context.audioAds.subsequentAdsAfter}function getAdsSkippingEnabled(){return context.adPlayer?adMediaType=="video"?context.adPlayer.videoAds.skippingEnabled:context.adPlayer.audioAds.skippingEnabled:context.audioAds.skippingEnabled}function getAdsUnskippableDuration(){return context.adPlayer?adMediaType=="video"?context.adPlayer.videoAds.unskippableDuration:context.adPlayer.audioAds.unskippableDuration:context.audioAds.unskippableDuration}function getAdsEnabled(a){return a?a=="audio"?context.adPlayer?context.adPlayer.audioAds.enabled:context.audioAds.enabled:context.adPlayer?context.adPlayer.videoAds.enabled:!1:context.adPlayer?context.adPlayer.audioAds.enabled||context.adPlayer.videoAds.enabled:context.audioAds.enabled}function hideLoginPrompt(){comm.send("login.hidePrompt")}function ready(a){ready[a]=!0,a=="swf"&&comm.send("playerMonitor.swfResponsive"),log(a,"ready.");var b=ready.swf&&ready.scomm;b&&(log("player ready"),Myspace.Player.ready=!0,initialAdPlayFinishCallback=function(){_comm.broadcast("ready"),Number(cookie("at"))>0&&cookie({at:getAdsFirstAdAfter()}),!mediaItem&&(!context.video||!context.video.isLiveStream)&&activate(),initialAdPlayFinishCallback=undefined},checkActive(function(){_comm.broadcast("ready"),player.active||(send("state",null,localStorage.activePlayer),_comm.broadcast("sync"))},function(){if(context.playInitialAd){activating(),adMediaType="video";var a=context.playInitialAdLocationId;a&&loadAd({locationId:a})}else initialAdPlayFinishCallback()}))}function send(a,b,c,d,e){scomm.send&&scomm.send("player."+a,b,c,d,e)}function checkActive(a,b){log("checking for active player.");try{localStorage.activePlayer?player.active||send("ping",null,localStorage.activePlayer,function(){log("active player not responding."),delete localStorage.activePlayer,b&&b()},function(){log("active player found. syncing."),a&&a()}):(log("no active player."),b&&b())}catch(c){}}function activate(){log("activate player."),_comm.broadcast("activate")}function activating(){send("deactivate");try{player.active||(log("activating player."),localStorage.activePlayer=scomm.hash,_comm.broadcast("activated"),log("player activated."))}catch(a){}}function deactivate(){ad.isPlaying&&(onAdStop=undefined),player.swf.pauseCurrentTrack();try{player.active&&(delete localStorage.activePlayer,_comm.broadcast("deactivated"),log("player deactivated."))}catch(a){}}function check(a){a.forEach(function(a){a!=scomm.hash&&send("check",null,a,function(){remove(a)})})}function save(a){try{localStorage.players=JSON.stringify(a)}catch(b){}}function remove(a){var b=instances(),c=b.indexOf(a);c>-1&&(b.splice(c,1),save(b))}function instances(){var a=[];try{a=JSON.parse(localStorage.players)}catch(b){}return $.isArray(a)?a:[]}function getLiveStreamObject(a,b){var c={};c.mediaType="video",c.isLiveStream=!0,c.liveControlsEnabled=a.liveControlsEnabled,c.replayControlsEnabled=a.replayControlsEnabled,c.startDate=a.startDate,c.endDate=a.endDate,c.streamHttpBase=a.publishingEntryPointStreamHttpBase,c.streamTitle=a.publishingEntryPointStreamTitle,c.isCurrentlyAiring=a.isCurrentlyAiring,c.isEnded=a.isEnded;var d=b?b.toLowerCase():a.publishingEntryPointInitialViewPointName.toLowerCase(),e;for(e=1;e<10;e++){var f=a[d+"Stream_"+e];if(!f)break;c["stream_"+e]=f}return c}function log(){context.reportSongEnabled&&console.log.apply(console,arguments)}var mediaItem,prevMediaItem,tsl=0,focused,cookie=new CookieHelper("player"),adsCookie=new CookieHelper("ads"),player=Myspace.Player,loading,onResume,onAdStop,previewCurrentTime,previewStreamStartDateTime,liveStreamCurrentTime,liveStreamStartDateTime,videoRequest,adMediaType,ad={isPlaying:undefined,skipped:undefined},initialAdPlayFinishCallback,switchboard={load:function(a){if(!a)return;activating(),setMode(a.mode),a.mediaItem?a.mediaItem.videoId?getVideo(a.mediaItem.videoId,function(b){context.playVideosLinkedToSongs&&a.mode=="queue"&&a.playLinkedVideo!=0?comm.send("queue.play.video",b):(a.mediaItem.video=b,load(a))},function(){load(a)}):load(a):this.pause()},unload:function(a){a==cookie("mode")&&(mediaItem&&!mediaItem.isAuthorized&&hideLoginPrompt(),player.pause(),setTime(0),tsl=0,mediaItem=undefined,broadcast("unloaded",getState()))},pause:function(){player.active?(cookie({paused:!0}),ad.isPlaying?broadcast("pauseAd"):player.pause(),broadcast("paused",getState())):send("pause",null,localStorage.activePlayer)},resume:function(){if(player.active){if(mediaItem&&!mediaItem.isAuthorized){comm.send("login.prompt",{action:"play",object:mediaItem.entityKey});return}cookie({paused:!1}),onResume?(onResume(),onResume=undefined):ad.isPlaying?broadcast("resumeAd"):player.resume(),broadcast("resumed",getState())}else send("resume",null,localStorage.activePlayer)},playPause:function(){cookie("paused")?this.resume():this.pause()},seek:function(a){if(player.active){if(mediaItem.isFreeTheTrackSong&&a>mediaItem.allowedPlay)return;setTime(a),player.seek(a),broadcast("seeked",a)}else send("seek",a,localStorage.activePlayer)},volume:function(a){volume(a),send("volume",a)},mute:function(a){mute(a),send("mute",a)},previous:function(){mode("previous")},next:function(){ad.isPlaying?stopAd():mode("next")},shuffle:function(){var a=!cookie("shuffled");cookie({shuffled:a}),mode("shuffle",a),broadcast("shuffleChanged",a)},repeat:function(){var a=cookie("repeat")=="off"?"all":cookie("repeat")=="all"?"one":"off";cookie({repeat:a}),broadcast("repeatChanged",a)},nowPlaying:function(a){$.isFunction(a)&&a(getState())},activate:function(){activate()},deactivate:function(){deactivate()},tryActivate:function(){focused?activate():setTimeout(function(){scomm.hash==instances()[0]&&checkActive(undefined,activate)},100)},queueChanged:function(a){_comm.broadcast("queueChanged",a)},state:function(a){a&&a.mediaItem&&mediaItem&&a.mediaItem.mediaId==mediaItem.mediaId&&$.extend(mediaItem,a.mediaItem),broadcast("state",getState(a))},toggleClosedCaptions:function(){mediaItem&&toggleClosedCaptions()},loadAd:function(){loadAd()},stopAd:function(){player.isPlaying&&player.stopAd()},nextAdAfter:function(a){isNaN(a)||cookie({at:a})},adClick:function(){_comm.broadcast("adClicked",ad)},incognito:function(a){a==undefined&&(a=!cookie("incognito")),cookie({incognito:a}),broadcast("incognitoChanged",a)},changeLiveStreamPOV:function(a){var b=getLiveStreamObject(mediaItem,a.povName);player.changeLiveStreamPOV(b)},unloadTrack:function(){player.unloadTrack(),broadcast("unloaded")}},_comm=comm.own("player",switchboard);comm.listen("page.changed",function(){mediaItem&&_comm.broadcast("state",getState())},!0),comm.listen({player:{"+adStarted":function(){ad.isPlaying=!0,ad.skipped=!1},"+adStopped":function(){ad.isPlaying=!1,initialAdPlayFinishCallback&&(initialAdPlayFinishCallback(),adsCookie({adInitVisit:Date.now()})),player.active&&((!mediaItem||mediaItem.mediaType!="video"||!mediaItem.isPremium)&&cookie({at:getAdsSubsequentAdsAfter()}),onAdStop&&onAdStop()),onAdStop=undefined},"+adRemainingTime":function(a){ad.skipped&&a.nonSkipTime==0&&stopAd()},"+loading":function(){videoRequest&&videoRequest.abort()},"+adClicked":function(){player.isPlaying&&player.sendAdClickTracking()},"+resumeAd":function(){player.isPlaying&&player.resumeAd()},"+pauseAd":function(){player.isPlaying&&player.pauseAd()}}}),$.extend(player,{onPlayerLoaded:function(a){Myspace.Player.version=a,cookie("mute")?this.mute(!0):this.volume(cookie("volume")),ready("swf")},onSongLoaded:function(a,b,c){loading=!1,broadcast("loaded",getState()),cookie("ccOn")&&mediaItem&&mediaItem.timedTextUrl&&Myspace.Player.activateClosedCaptions(!0)},onPlayStarted:function(){mediaItem.streamStartDateTime||setStreamStartDateTime((new Date).toISOString()),broadcast("started",getState())},onCurrentTime:function(a,b,c,d,e){if(loading)return;var f=getTime(),g;d!==undefined?(tsl=d,g=e):f<a&&(g=a-f,tsl+=g),g>0&&cookie({at:Math.max(cookie("at")-g,0)}),setTime(a),broadcast("time",{time:a,tsl:tsl,buffer:b,backBuffer:c})},onBufferStatus:function(a){broadcast("bufferStatus",a)},onStop:function(a){cookie({originalStreamUTCDateTime:""}),broadcast("bufferStatus",!1),broadcast("ended",getState()),mediaItem=undefined,mode("end")},onError:function(a,b){(a.indexOf("stream rejected")>-1||a.indexOf("streamRejected")>-1||a.indexOf("streamLengthZero")>-1)&&mode("error",a),context.features.isPlayerErrorBeaconEnabled&&broadcast("error",{errorType:a,errorText:b})},displayAd:function(a,b){},setCurrentPlayTime:function(a){broadcast("time",{time:a,tsl:tsl})},onVolumeChange:function(a){},stopAdDisplay:function(){},onDurationReceived:function(a){mediaItem.duration=a,broadcast("duration",a)},mouseMove:function(a,b){_comm.broadcast("mouseMove",{x:a,y:b})},onClick:function(a,b,c){_comm.broadcast("onClick",{x:a,y:b,mediaInfo:c});if(c&&c.isAd&&c.mediaType=="video"&&ad&&ad.clickThroughUrl){var d=/https?\:\/\/(\w+\.)?myspace\.com/,e=ad.clickThroughUrl.indexOf(document.domain)==-1&&!ad.clickThroughUrl.match(d);e&&comm.send("player.pause")}},keyDown:function(a){_comm.broadcast("keyDown",a)},onClose:function(){log("swf onClose")},onTimeout:function(){log("swf onTimeout")},onFullScreenEntered:function(){log("swf entered fullscreen")},onFullScreenExited:function(){log("swf exited fullscreen")},adLoading:function(a){log("swf ad loading"),broadcast("adLoading",{isVideo:a})},adLoaded:function(a){a==undefined&&(a=adMediaType=="video"),log("swf ad loaded, isVideo: "+a),broadcast("adLoaded",{isVideo:a})},adStarted:function(a,b,c){log('swf ad started, adInfo = "'+c+'"'),player.isPlaying=!0,ad.clickThroughUrl=a,ad.enableSkipAfter=getAdsSkippingEnabled()&&getAdsUnskippableDuration(),broadcast("adStarted",{clickThroughUrl:ad.clickThroughUrl,enableSkipAfter:ad.enableSkipAfter,isVideo:b,adInfo:c})},adStopped:function(a){player.isPlaying=!1,broadcast("adStopped",{isVideo:a})},adDuration:function(a){ad.duration=a,broadcast("adDuration",a)},adRemainingTime:function(a,b){ad.isPlaying&&(ad.remainingTime=a,ad.enableSkipAfter=getAdsSkippingEnabled()&&Math.max(getAdsUnskippableDuration()-b,0),broadcast("adRemainingTime",{remainingTime:a,enableSkipAfter:ad.enableSkipAfter}))},onLivePlayStatus:function(a,b){var c=cookie("mode"),d="vod";c=="liveStream"&&(a&&b?d="live":a&&!b?d="dvr":d="replay"),mediaItem.mediaPlayMode=d,broadcast("mediaPlayModeChange",{mediaPlayMode:d})},onLiveEventEnded:function(){broadcast("liveEventEnded")}}),scomm.add(function(cmd,data,sender){var parts=cmd.split("."),owner=parts[0],fromMode=parts[1],cmd=parts[2];if(owner!="queue"||fromMode!=mode)return;eval(cmd)(data)}),scomm.add(function(a,b,c){var d=a.split("."),e=d[0],a=d[1],f=d[2];if(e!="player")return;b&&b.mediaItem&&setMediaItem(b.mediaItem);switch(a){case"ad":ad=b,ad.isPlaying&&(_comm.broadcast("adStarted",{clickThroughUrl:ad.clickThroughUrl,enableSkipAfter:ad.enableSkipAfter}),_comm.broadcast("adDuration",ad.duration),_comm.broadcast("adRemainingTime",{remainingTime:ad.remainingTime,enableSkipAfter:ad.enableSkipAfter}));break;case"state":send("broadcast.state",getState(),c),mediaItem.video&&send("broadcast.videoPreview",mediaItem.video,c),send("ad",ad,c);break;case"broadcast":_comm.broadcast(f,b);break;case"volume":volume(cookie("volume"));break;case"mute":mute(cookie("mute"));break;default:comm.send("player."+a,b)}}),scomm.ready(function(){var a=instances();a.unshift(scomm.hash),save(a),check(a),ready("scomm")}),Object.defineProperty(player,"active",{get:function(){try{return localStorage.activePlayer==scomm.hash}catch(a){return!0}}}),$(window).on("beforeunload",function(){try{player.active&&(delete localStorage.activePlayer,send("tryActivate")),remove(scomm.hash)}catch(a){}}).on("focus",function(){focused=!0}).on("blur",function(){focused=!1})})();
(function(){function h(a){return!d.find(".list."+a+" li").length}function i(a){return d.find(".list."+a)}function j(a){$("#save_queue, #clear_queue").attr("disabled",a==undefined||a?null:"disabled")}function k(a){var b=$("#queue .list li.selected:visible");if(f.is(":animated")||!b.length)return;var c=f.offset().left,d=f.outerWidth(),e=b[0].offsetLeft,g=b.position().left,h=b.width(),i=b.outerWidth();(a||g<c||g+h>c+d)&&f.animate({scrollLeft:e-c-d/2+i/2},400)}function l(a,b,c){comm.send("track",new Tracking(a,b,c))}var a,b,c=$("#footer"),d=$("#queue"),e=$("#queue .options"),f=$("#queue .horizontal"),g=$("#station");comm.listen({player:{"+ready":function(){if(queryString.play=="1")if(context.pfc=="song"||context.pfc=="artistSong"||context.pfc=="albumSong"){var a=$("#song .mediaItems .playBtn").first();a.length&&comm.send("queue.play.song",objectify(a))}else if(context.pfc=="artistSongs"){var a=$("#sidebar .mediaSquare .connectButton").first();a.length&&comm.send("playRadio",objectify(a))}else if(context.pfc=="artistAlbum"||context.pfc=="album"){var a=$("#album .playBtn").first();a.length&&comm.send("queue.play.album",objectify(a))}else if(context.pfc=="mixdetail"){var a=$("#mixData .playBtn").first();a.length&&comm.send("queue.play.mixtape",objectify(a))}else k(!0);else k(!0)},"+mode":function(a){a=="preview"&&(comm.send("drawer.message","Previewing..."),setTimeout(function(){comm.send("drawer.message")},500)),j(!h(a))},"+loading":function(a){k()},"+queueChanged":function(a){c.hasClass(a.mode)&&c.toggleClass("empty",h(a.mode)),comm.send("page.changed",i(a.mode)),j(!h(a.mode))},"+adStarted":function(a){comm.send("drawer.cover",a.nonSkipTime>0?"Skip in "+Math.ceil(a.nonSkipTime)+" seconds...":"")},"+adRemainingTime":function(a){comm.send("drawer.cover",a.nonSkipTime>0?"Skip in "+Math.ceil(a.nonSkipTime)+" seconds...":"")},"+adStopped":function(a){comm.send("drawer.cover")}},queue:{"+loading":function(a){var b="Loading";if(a&&a.title){b+=" "+a.title;if(a.artistName||a.owner)b+=" by "+(a.artistName||a.owner)}b+="...",comm.send("drawer.message",b)},"+loaded":function(){comm.send("drawer.panel","queue"),comm.send("drawer.message")}},radio:{"+starting":function(c){comm.send("drawer.message","Starting "+(c.title||c.name||"")+" Radio..."),a=!1,b=setTimeout(function(){b=null,a&&comm.send("drawer.message")},2e3),g.find("img").attr("src",c.imageUrl),g.find("h6 a").text(c.title||c.name)},"+started":function(c){a=!0,comm.send("drawer.panel","queue"),b||comm.send("drawer.message")}},drawer:{"+opened":function(a){a=="queue"&&k(!0)},"+panel":function(a){a=="queue"&&k(!0)}}}),e.on("click",function(a){var b=$(a.target).closest("button");if(b.is("[disabled]"))return;switch(b.attr("id")){case"full_queue":spaceway.href="/queue",l("playerQueue","fullQueue","clicked");break;case"history":spaceway.href="/history",l("playerQueue","history","clicked");break;case"save_queue":l("playerQueue","save","clicked"),comm.send(Cookies.player.values.mode+".media",function(a){comm.send("mix.addItems",a)});break;case"clear_queue":l("playerQueue","clear","clicked");var c;Myspace.Confirm({text:"Are you sure you want to clear your queue?",yes:{text:"Yes",onClick:function(){comm.send(Cookies.player.values.mode+".clear"),c=!0}},no:{text:"No"}});function d(){l("playerQueue","clear",c?"confirmed":"cancelled"),comm.stopListening("dialog.hiding",d)}comm.listen("dialog.hiding",d)}})})();
var Myspace=Myspace||{};Myspace.Mixes=function(a){function d(a,b){var c=objectify(b.find(".playBtn"));return c.title}function e(a,b){b.parent().addClass("dragged")}function f(a,b){b.parent().removeClass("dragged")}function g(a,b){var c,d=b.find(".playBtn").data("sequence-id"),e=b.next().find(".playBtn").data("sequence-id");d==0?c=b.find(".playBtn").data("playlist-id"):c=d;var f={playlistId:c,beforeSequenceId:e};o("reorder"),comm.send("mix.move",f)}function h(c){var d=a(c);b.find(".newMix").after(d),Myspace.DragDrop.addDroppables(d)}function i(a,c){var d=b.find('.mix [data-playlist-id="'+a+'"]').closest("li");d.find(".mixCover").removeClass("collage").html('<img src="'+c[3].url+'" />')}function j(a){b.find('.mix [data-playlist-id="'+a+'"]').closest("li").addClass("noMedia")}function k(a){b.find('.mix [data-playlist-id="'+a+'"]').closest("li").removeClass("noMedia")}function l(a,b,c,d){o("removeOwnMix","click");var e={playlistId:a,objectVersion:b,title:d,entityKey:c,onSuccess:function(a){a.entityKey=c,comm.send("mix.deleted",a),o("removeOwnMix","confirmed")},onCancel:function(){o("removeOwnMix","cancelled")}};comm.send("mix.delete",e)}function m(c){var d=b.find('[data-entity-key="'+c.playlist.entityKey+'"]').closest("li"),e=a(c.markup);d.replaceWith(e),Myspace.DragDrop.addDroppables(e)}function n(a){b.find('[data-entity-key="'+a.entityKey+'"]').closest("li").remove()}function o(a,b){comm.send("track",new Tracking("playerMixes",a,b))}var b=a("#mixes .list");comm.listen("mix.imageChanged",function(a){i(a.playlistId,a.imgs)},!0),comm.listen("mix.created",function(a){h(a.markup)},!0),comm.listen("mix.removeItem",function(a){a.totalRecords||j(a.playlistId)},!0),comm.listen("mix.addItem",function(a){k(a.playlistId)},!0),b.find(".newMix").click(function(a){a.preventDefault(),a.stopPropagation(),comm.send("mix.create",{onSuccess:function(){o("newMix","created")},onCancel:function(){o("newMix","cancelled")}}),o("newMix","click")}),b.click(function(b){var c=a(b.target);if(c.hasClass("remove")){b.preventDefault(),b.stopPropagation();var d=c.parent().children(".playBtn"),e=objectify(d),f=c.closest("li");f.hasClass("mix")?l(e.playlistId,e.objectVersion,e.entityKey,e.title):(comm.send("mix.deleted",e),comm.send("disconnect",{entityKey:e.entityKey,playlistId:e.playlistId,onSuccess:function(a){comm.send("connect.status",{entityKey:e.entityKey})}}),o("removeConnectedMix","click"))}else if(!c.hasClass("playBtn")&&!c.hasClass("artist")){b.preventDefault(),b.stopPropagation();var g=c.closest("li").find(".title").attr("href");comm.send("location.href",g)}else c.hasClass("playBtn")&&o("play")});var c={$elem:b,activeClass:"dragee",ignoreSelectors:".util",hoverSupressorClass:"transp",dragText:d,dragStart:e,dragEnd:f,drop:g};return new Myspace.SortManager(c),comm.listen("mix.deleted",n,!0),{add:h,edit:m,remove:n}}(jQuery);
(function(){function l(a){if(!j||a.mediaItem.mediaId!=j.mediaId)j=a.mediaItem,k=!0;b.attr("data-panel")=="radio"&&m()}function m(){if(!k)return;var a="";j.genreName&&j.genreRadioStationEntityKey&&(a+=require("ejs").render(templates["common/views/footer/_queueItem"],{queueItem:{type:"radio",radioStationEntityKey:j.genreRadioStationEntityKey,imageUrl:config.urls.emptyAlbumImage,title:j.genreName,name:"Radio",disableLinks:!0}})),d.find("li:not(.search)").remove(),d.append(a),k=!1}function n(a,b){comm.send("track",new Tracking("playerRadio",a,b))}var a=$("#footer"),b=$("#drawer"),c=$("#radio"),d=$(".options",c),e=$("#radioStations"),f=$("#radio .search"),g=$("#radioBtn"),h=$("#switcher"),i,j,k;comm.listen({player:{"+ready":function(){queryString.play=="1"&&context.pfc=="Profile"&&$("#profileImage .playBtn.radio").click()},"+state":l,"+loading":l},drawer:{"+panel":function(a){a=="radio"&&m()}},radio:{"+started":function(b){var c=e.find('.playBtn[data-radio-entity="'+b.radioEntity+'"]');if(c.length)c.parents("li").prependTo(e);else{var b=require("ejs").render(templates["common/views/footer/_queueItem"],{queueItem:b});e.prepend(b),a.removeClass("noStations")}}}}),g.on("mouseenter mouseleave",function(){m()}),h.on("mouseenter mouseleave",function(){m()}),d.on("click",function(a){var b=$(a.target),c=b.closest("li");if(b.hasClass("playBtn")){var d=b.attr("data-radio-station-entity-key"),e=d.indexOf("song")>-1?"song":d.indexOf("artist")>-1?"artist":d.indexOf("genre")>-1?"genre":"";n("newStation",e);return}c.length&&c.find(".playBtn").click()}),f.on("mouseenter",function(){i||(i=new Myspace.RadioDialog)}).on("click",function(){i||(i=new Myspace.RadioDialog),i.$root.hasClass("open")||(i.show(),n("search","clicked"))}),e.on("click",function(b){var c=$(b.target),d=c.closest("li");if(c.hasClass("playBtn")){n("existingStation"),setTimeout(function(){d.prependTo(e)},400);return}c.attr("data-action")=="remove"?($.post("/ajax/music/radio/remove",{radioEntity:d.find(".playBtn").attr("data-radio-entity")}),d.addClass("removing"),setTimeout(function(){d.remove(),e.find("li").length||a.addClass("noStations")},250)):d.length&&d.find(".playBtn").click()})})();
Myspace.RadioSearch=function(){var a,b;return function(c,d){a&&a.abort();if(!c){d();return}window.clearTimeout(b),b=window.setTimeout(function(){comm.send("track",new Tracking("radioSearchOverlay","query")),a=$.ajax({type:"post",contentType:"application/json",url:"/ajax/search/autocomplete?"+$.param({type:"song",limit:10,q:c,includeGenres:!0}),success:d})},200)}}(),Myspace.RadioDialog=function(){function d(c){if(c.which==0)return;var d=c.which==8||c.which==13?c.target.value:c.target.which+String.fromCharCode(c.which);d==""?b.removeClass("results"):Myspace.RadioSearch(d,function(c){var d="";c.genres&&(d+=e(c.genres)),a.$root.find("ul.results").html(d),b.addClass("results")})}function e(a){var b="";return Array.isArray(a)&&a.forEach(function(a){b+=f({radioStationEntityKey:a.radioStationEntityKey,genreId:a.genreId,name:a.name.replace("/"," / ").replace("  "," "),imageUrl:a.imageUrl,imageUrls:a.imageUrls})}),b}function f(a){var b="media size_50 inline",c=[];a.imageUrls&&a.imageUrls.length>=4?(c=c.concat(a.imageUrls),b+=" collage"):c.push(a.imageUrl);var d='<li class="'+b+'"><a>'+play("radio",a);for(var e=0;e<c.length;++e)d+=g(c[e]);return d+="</a><div><span>"+a.name+"</span></div></li>",d}function g(a){return'<img src="'+(a||config.urls.emptyAlbumImage)+'">'}function h(a,b){comm.send("track",new Tracking("radioSeachOverlay",a,b))}var a=new Myspace.Dialog($(require("ejs").render(templates["areas/music/views/radioDialog"])).appendTo("body")),b=a.$root.find(".search"),c;$.post("/ajax/music/genres/featured",null,function(b){var c=e(b);a.$root.find("ul.genres").html(c),a.$root.hasClass("open")&&a.center()}),a.$root.on("click",function(b){var c=$(b.target);if(c.hasClass("playBtn")){a.hide(),c.closest("ul.results",a.$root).length?h("click","results"):c.closest("ul.genres",a.$root).length&&h("click","genres");return}var d=c.closest("li").find(".playBtn.radio");return d.length&&d.click(),c.is("a")}).on("submit",function(){return!1}),a.$root.find("input").on("keypress",d).on("keyup",function(a){a.keyCode==8&&d(a)}),this.hide=a.hide,this.$root=a.$root,this.show=function(){function b(){context.beaconData.pf=c,comm.stopListening("dialog.hide",b)}a.show(),h("invoke"),c=context.beaconData.pf,context.beaconData.pf="radiosearchoverlay",comm.send("beacon",context.beaconData),comm.listen("dialog.hiding",b)}};
(function(){function x(a){var b=a/60|0,c="0"+Math.floor(a%60);return b+":"+c.substr(c.length-2)}function y(a){var b=0;a.isFreeTheTrackSong&&(b=(1-a.allowedPlay/a.duration)*100+"%"),u.width(b)}function F(a){D||E.percent(a),C.width(a*100+"%"),A.attr("class","noStyle volume_"+(a<.05?"off":a>=.05&&a<.2?"low":a>=.2&a<.8?"mid":"max"))}function G(a){return a.indexOf(document.domain)==-1&&!a.match(/https?\:\/\/(\w+\.)?myspace\.com/)}function H(b){a=b.mediaItem;if(e.hasClass("ad"))return;J(b.mediaItem),Q(b.mode),I(b.paused),y(b.mediaItem),p.html(x(b.time)),q.html(" / "+x(a.duration)),t.width(b.time/a.duration*100+"%"),w.percent(b.time/a.duration)}function I(a){e.toggleClass("paused",a),U("play",a?"Play":"Pause")}function J(a){K(a.title,a.titleVersion,a.isExplicit,a.url||a.detailUrl),L(a.artistName,a.artistUrl),M(a.title,a.artistName),P(a.sourceName||a.albumTitle,a.sourceUrl||a.albumUrl),S(a.video)}function K(a,b,c,d,e,f){var g="";a&&(a=htmlDecode(a),d?(g=$("<a></a>").attr("href",d).text(a).click(f),e&&g.attr("target",e)):g=$("<span></span>").text(a)),b&&g.append('\n<span class="version">('+b+")</span>"),c&&g.append('\n<i class="explicit_10"></i>'),l.html(g)}function L(a,b){var c="";a&&(c=(b?$("<a></a>").attr("href",b):$("<span></span>")).text(htmlDecode(a))),m.html(c)}function M(a,b){var c="";a&&(c=htmlDecode(a)),b&&(c+=" by "+htmlDecode(b)),document.title=c||"Myspace"}function P(a,b){k.attr("class","track");var c="";a&&(c=(b?$("<a></a>").attr("href",b).attr("title",a):$("<span></span>")).text(a)),N&&clearTimeout(N),O&&clearInterval(O),setTimeout(function(){o.html(c)},1e3),c&&(N=setTimeout(function(){k.attr("class","source")},1e4),O=setInterval(function(){k.attr("class","track"),N=setTimeout(function(){k.attr("class","source")},1e4)},13e3))}function Q(a){var b=$("#playControls .connectButton"),c=$("#queue .list."+a+" .selected .connectButton");if(c.length){var d=$('<button data-action="connect"><span></span><span></span></button>');$.each(c.prop("attributes"),function(a,b){b.name!="data-popover-initialized"&&d.attr(b.name,b.value)}),d.addClass("dark"),b.replaceWith(d),comm.send("hcard.init",f)}else b.attr("disabled","disabled")}function R(a){L(a?"(skip in "+Math.ceil(a)+" seconds)":""),a===0&&g.removeAttr("disabled")}function S(a){var b="";a&&a.mediaType=="video"&&(b=$('<a href="'+a.detailUrl+'"><i class="video_16" target="_self"></i></a>').click(function(){return comm.send("queue.find.video",a),Myspace.VideoPlayer.closed=!1,Myspace.VideoPlayer.show(),!1})),n.html(b)}function T(){var a=$("#playControls button, #modeControls button"),b=$();e.hasClass("empty")&&(b=a.not('[data-action="radio"]')),e.hasClass("radio")&&(b=a.filter('[data-action="shuffle"], [data-action="repeat"], [data-action="previous"]'+(e.hasClass("allowSkips")?"":', [data-action="next"]')));if(e.hasClass("preview")||e.hasClass("liveStream"))b=a.filter('[data-action="shuffle"], [data-action="repeat"], [data-action="radio"]');if(e.hasClass("ad")||e.hasClass("liveStream"))b=a.filter('[data-action="previous"], [data-action="next"], [data-action="connect"], [data-action="shuffle"], [data-action="repeat"]');a.not(b).removeAttr("disabled"),b.attr("disabled","disabled");var c="";b.each(function(a,b){var d=b.getAttribute("data-tip-name");d&&(c+=(c.length?", ":"")+'.footertip[data-name="'+d+'"]')}),$(c).hide()}function U(a,b){var c=$("body");c.find('.tip[data-name="'+a+'"] .tip-inner').text(b),c.find('[data-tip-name="'+a+'"]').attr("data-original-title",b)}function V(a,b,c){comm.send("track",new Tracking(a,b,c))}var a,b,c,d=$("body"),e=$("#footer"),f=$("#player"),g=$('#playControls button[data-action="next"]'),h=$("#incognito");f.on("click",function(a){var b=$(a.target).closest("[data-action]:not([disabled])"),c=b.attr("data-action");if(c)switch(c){case"radio":var d=e.hasClass("radio");d?(comm.send("queue.activate"),V("player","radio","off")):V("player","radio","clicked"),comm.send("drawer.panel",d?"queue":"radio");break;case"mixes":case"queue":return comm.send("drawer.panel",c),V("player","panel",c),!1;case"play":c=e.hasClass("paused")?"resume":"pause",comm.send("player."+c),V("player",c);break;case"connect":V("player","connect",b.hasClass("connected")?"disconnect":"connect");break;case"shuffle":comm.send("player.shuffle"),V("player","shuffle",e.hasClass("shuffled")?"on":"off");break;case"repeat":comm.send("player.repeat"),V("player","repeat",e.hasClass("repeatAll")?"all":e.hasClass("repeatOne")?"one":"off");break;case"mute":comm.send("player.mute"),V("player","mute",e.hasClass("muted")?"on":"off");break;case"signin":return comm.send("login.show",{context:{action:"signInPlayer"}}),!1;default:V("player",c),comm.send("player."+c)}});var j=$("#nowPlaying"),k=$("h5",j),l=$(".title",j),m=$(".artist",j),n=$(".videoLink",j),o=$(".source span",j),p=$(".time",j),q=$(".duration",j),r=$(".meter",j),s=$(".buffer",r),t=$(".trailer",r),u=$(".disabledDuration",r),v,w=new Myspace.Slider(r,{units:"%",axis:"x",jump:function(b,c){var d=b/c*a.duration;!a.isFreeTheTrackSong&&d<a.allowedPlay&&(p.html(x(d)),t.width(b/c*100+"%"),comm.send("player.seek",d)),V("player","seek")},start:function(a,b){v=!0,t.width(a/b*100+"%")},drag:function(a,b){t.width(a/b*100+"%")},stop:function(b,c){v=!1,comm.send("player.seek",b/c*a.duration),V("player","seek")}}),z=$("#volumeControl"),A=$("#volumeBtn"),B=$(".meter",z),C=$(".trailer",z),D,E=new Myspace.Slider(B,{units:"%",axis:"x",jump:function(a,b){comm.send("player.volume",a/b),V("player","volume")},start:function(a,b){D=!0,comm.send("player.volume",a/b)},drag:function(a,b){comm.send("player.volume",a/b)},stop:function(a,b){D=!1,V("player","volume")}});comm.listen({player:{"+mode":function(a){e.removeClass("radio queue preview liveStream").addClass(a).toggleClass("empty",!$("#queue .list."+a+" li").length),T()},"+preloading":function(a){e.hasClass("ad")?(c=Myspace.genericDialog({html:"<p>Your "+a.mediaItem.type+" has been queued. It will begin shortly.</p>",id:"queuedDialog",buttons:null,close:!1}),setTimeout(function(){c.hide()},3e3)):(s.width("0%"),H(a))},"+loading":function(a){b=!0,e.removeClass("ad"),s.width("0%"),H(a)},"+loaded":function(a){b=!1},"+paused":function(){I(!0)},"+resumed":function(){I(!1)},"+ended":function(){I(!0)},"+state":function(a){H(a),I(a.paused)},"+time":function(c){if(!b){p.html(x(c.time)),v||(t.width(Math.min(c.time/a.duration,1)*100+"%"),w.percent(Math.min(c.time/a.duration,1)));var d=c.time+c.buffer;a.isFreeTheTrackSong&&(d=Math.min(a.allowedPlay,d)),s.width(Math.min(d/a.duration,1)*100+"%")}},"+duration":function(a){q.html(" / "+x(a)).attr("data-duration",a)},"+volumeChanged":function(a){F(a),e.removeClass("muted")},"+muted":function(){F(0),U("mute","Unmute"),e.addClass("muted")},"+unmuted":function(){F(Cookies.player.values.volume),U("mute","Mute"),e.removeClass("muted")},"+repeatChanged":function(a){e.toggleClass("repeatAll",a=="all").toggleClass("repeatOne",a=="one")},"+shuffleChanged":function(a){e.toggleClass("shuffled",a)},"+queueChanged":function(a){e.hasClass(a.mode)&&e.toggleClass("empty",!$("#queue .list."+a.mode+" li").length),T()},"+adStarted":function(a){var b=G(a.clickThroughUrl),c=b||!a.adInfo?"Advertisement Info":a.adInfo,d=b?"_blank":"";K(c,undefined,undefined,a.clickThroughUrl,d,function(){return comm.send("player.adClick"),!1}),R(a.enableSkipAfter),P(),t.width(0),s.width(0),r.attr("disabled","disabled"),e.addClass("ad"),T(),I(!1)},"+adClicked":function(a){G(a.clickThroughUrl)?window.open(a.clickThroughUrl):comm.send("location.href",a.clickThroughUrl)},"+adDuration":function(a){q.html(" / "+x(a)).attr("data-duration",a)},"+adRemainingTime":function(a){if(e.hasClass("ad")){p.html(x(a.remainingTime)),s.width(0);var b=parseInt(q.attr("data-duration"));t.width((b-a.remainingTime)/b*100+"%"),R(a.enableSkipAfter)}},"+adStopped":function(){c&&c.hide(),r.removeAttr("disabled"),e.removeClass("ad"),T()},"+videoPreview":function(a){S(a)},"+incognitoChanged":function(a){h.toggleClass("on",a)},"+mediaPlayModeChange":function(a){a.mediaPlayMode=="replay"?f.find(".liveLabel").html("<i></i>Recorded"):a.mediaPlayMode=="live"||a.mediaPlayMode=="dvr"?f.find(".liveLabel").html("<i></i>Live"):f.find(".liveLabel").html("")},"+liveEventEnded":function(){f.find(".liveLabel").addClass("eventEnded"),I(!0)}},radio:{allowSkips:function(a){e.toggleClass("allowSkips",a),T()}},playerMonitor:{"+playerError":function(a){Myspace.VideoPlayer&&Myspace.VideoPlayer.show();for(i in a.swfs){var b=a.swfs[i];document.body.contains(b)&&$(b).addClass("flashUnresponsive")}delete a.swfs,comm.send("showSiteAlert",a)}}});var N,O;T()})();
(function(){var a={FBLog:!0,FBAssociatedUserId:null,FBCurrentUserId:null,url:window.location.href,FBSongUrl:queryString.song,prevActionId:0,IsPostToFacebookSettingEnabled:!0,settingsObjectVersion:0,FBLastStatusUrl:null,getId:function(a,b){var c=a.substr(a.lastIndexOf("-")+1);if(b){a=a.substr(0,a.lastIndexOf("-"));var d=a.substr(a.lastIndexOf("-")+1);d&&!isNaN(d)&&(c=d+";"+c)}return c},play:function(b){var c=a;c.FBLog&&console.log("play called from FB",1),c.FBLog&&console.log(b,1);if(b.song)c.FBSongUrl=b.song,$.ajax({type:"POST",dataType:"json",url:"/ajax/music/songObject",data:{id:c.getId(b.song,1)},success:function(a){comm.send("queue.play.song",a)},error:function(a){c.sendStatus(4)}});else if(b.album)$.ajax({type:"POST",dataType:"json",url:"/ajax/music/albumObject",data:{id:c.getId(b.album)},success:function(a){comm.send("queue.play.album",a)},error:function(a){c.FBSongUrl=b.album,c.sendStatus(4)}});else if(b.playlist){var d=b.playlist.toLowerCase();d="/ajax/music/mixObject"+d.substr(d.indexOf("myspace.com")+11),$.ajax({type:"POST",dataType:"json",url:d,success:function(a){comm.send("queue.play.mixtape",a)},error:function(a){c.FBSongUrl=b.playlist,c.sendStatus(4)}})}else if(b.musician){var d=b.musician.toLowerCase();d="/ajax/music/artistObject"+d.substr(d.indexOf("myspace.com")+11).replace("/music/songs",""),$.ajax({type:"POST",dataType:"json",url:d,success:function(a){comm.send("playRadio",a)},error:function(a){c.FBSongUrl=b.musician,c.sendStatus(4)}}),comm.send("radio.artist",c.getId(b.musician.toLowerCase().replace("/songs","")))}},pause:function(b){var c=a;c.FBLog&&console.log("pause called from FB",1),c.FBLog&&console.log(b,1),!b.song||c.FBLastStatusUrl==b.song?comm.send("player.pause",{}):c.sendStatus()},resume:function(b){var c=a;c.FBLog&&console.log("resume called from FB",1),c.FBLog&&console.log(b,1),comm.send("player.resume")},sendStatus:function(b){var c=a,d=Cookies.player.values.incognito=="true";d=d||!c.IsPostToFacebookSettingEnabled||context.loginId<=0;if(b&&typeof b=="number"){c.FBCurrentUserId&&c.FBSongUrl&&(c.FBLog&&console.log("Facebook Status: Error, ErrorCode: "+b+" ,song: "+c.FBSongUrl,1),FB.Music.send("STATUS",{error_code:b,playing:!1,song:c.FBSongUrl,user_id:c.FBCurrentUserId})),c.FBSongUrl="",c.FBLastStatusUrl=null;return}comm.send("player.nowPlaying",function(b){var e=b.mediaItem||{mediaId:0};c.FBAssociatedUserId&&c.prevMediaId&&c.prevActionId&&(b.paused||c.prevMediaId!=e.mediaId)&&c.prevStartTime>(new Date).getTime()-15e3&&($.ajax({type:"POST",dataType:"json",url:"/ajax/music/deleteaction",data:{actionId:c.prevActionId},success:function(b){var c=a;c.FBLog&&console.log("deleted",1)}}),c.prevActionId=null,c.prevMediaId=null);if(c.prevMediaId!=e.mediaId&&e.mediaId&&!b.paused&&c.FBAssociatedUserId&&!d){c.prevMediaId=e.mediaId,c.prevStartTime=(new Date).getTime(),c.prevActionId=null;if(e.mediaType=="video")$.ajax({type:"POST",dataType:"json",url:"/ajax/video/sendwatch",data:{videoUrl:e.detailUrl,videoDuration:e.duration-b.time,fbUserId:c.FBAssociatedUserId},success:function(b){var c=a;b.PostToFacebookDisabled?c.IsPostToFacebookSettingEnabled=!1:b.id&&(c.FBLog&&console.log(b.id,1),c.prevMediaId=e.mediaId,c.prevStartTime=(new Date).getTime(),c.prevActionId=b.id)}});else{var f=e.albumUrl;f.endsWith("/music/albums")&&(f=e.url+"?album=1"),$.ajax({type:"POST",dataType:"json",url:"/ajax/music/sendlisten",data:{songUrl:e.url,albumUrl:f,artistUrl:e.artistUrl,songDuration:e.duration-b.time,fbUserId:c.FBAssociatedUserId},success:function(b){var c=a;b.PostToFacebookDisabled?c.IsPostToFacebookSettingEnabled=!1:b.id&&(c.FBLog&&console.log(b.id,1),c.prevMediaId=e.mediaId,c.prevStartTime=(new Date).getTime(),c.prevActionId=b.id)}})}}if(c.FBCurrentUserId)if(!e||e.mediaType!="audio")c.FBLog&&console.log("Status: paused",1),FB.Music.send("STATUS",{playing:!1,user_id:c.FBCurrentUserId});else{if(c.FBSongUrl&&(c.getId(c.FBSongUrl,true).indexOf(e.mediaId)!=0||b.paused)){c.sendStatus(103);return}var g=(new Date).getTime()-b.time*1e3+(new Date).getTimezoneOffset()*6e4;g=new Date(g);var h=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate()+"T"+g.getHours()+":"+g.getMinutes()+":"+g.getSeconds();c.FBLog&&console.log("Status: "+(b.paused?"paused":"playing")+" name: "+e.title+" start: "+h+" duration: "+e.duration+" song: http://www.myspace.com"+e.url,1),FB.Music.send("STATUS",{playing:!b.paused,song:"https://myspace.com"+e.url,start_time:h,expires_in:e.duration-b.time,user_id:c.FBCurrentUserId}),c.FBLastStatusUrl="https://myspace.com"+e.url,c.FBSongUrl=""}})},checkAssociatedUser:function(){var b=a;!b.FBAssociatedUserId&&context.loginId>0&&$.ajax({url:"/ajax/thirdparty/facebook/accountinfo",type:"POST",success:function(a){a.success&&a.externalId&&a.accessToken?FB.api("/"+a.externalId+"/permissions?access_token="+a.accessToken,function(c){c.data&&c.data.length>0&&c.data[0].publish_actions&&(b.FBAssociatedUserId=a.externalId),b.InitListeners()}):b.InitListeners()},error:function(){b.InitListeners()}})},renewToken:function(){$("body").append('<iframe id="fbAuth" sandbox="allow-forms allow-same-origin allow-scripts" src="/thirdpartyauth/facebook/renewToken"></iframe>')},fbAsyncInit:function(){var b=a;FB.init({appId:config.thirdParty.facebookAppId,status:!0,cookie:!0,xfbml:!0,music:!0,oauth:!0,frictionlessRequests:!0}),FB.getLoginStatus(function(a){$("style:contains(fb_)").addClass("spaceway"),a.status=="connected"&&(b.FBCurrentUserId=a.authResponse.userID),b.checkAssociatedUser(),comm.listen("thirdparty.connected",b.checkAssociatedUser);var c=(new Date).getMonth()*100+(new Date).getDate();if(context.loginId>0&&!localStorage.FBLastRenewed||localStorage.FBLastRenewed!=c){b.renewToken();try{localStorage.FBLastRenewed=c}catch(d){}}},!0)},InitListeners:function(){var b=a;if(b.listenersInitialized)return;b.listenersInitialized=!0,FB.Event.subscribe("fb.music.PLAY",b.play),FB.Event.subscribe("fb.music.RESUME",b.resume),FB.Event.subscribe("fb.music.PAUSE",b.pause),FB.Event.subscribe("fb.music.STATUS",b.sendStatus),comm.listen({player:{"+started":function(a){b.FBLog&&console.log("played",1),b.FBSongUrl&&a&&a.mediaItem&&b.FBSongUrl.lastIndexOf(a.mediaItem.mediaId)>=0&&(b.FBSongUrl=""),b.sendStatus()},"+resumed":function(a){b.FBLog&&console.log("resumed",1),b.sendStatus()},"+paused":function(a){b.FBLog&&console.log("paused",1),b.sendStatus()},"+ended":function(a){b.FBLog&&console.log("ended",1),b.sendStatus()},"+error":function(b){var c=a;b&&b.type&&(b.type==="flash"&&(b.msg.startsWith("stream rejected")||b.msg.startsWith("streamRejected"))?c.sendStatus(4):b.type==="permissions"&&c.sendStatus(103))}}}),a.sendStatus()},init:function(){var b=a;window.fbAsyncInit=this.fbAsyncInit,$("body").append('<div id="fb-root"></div>');var c=document.createElement("script");c.async=!0,c.src=document.location.protocol+"//connect.facebook.net/en_US/all/vb.js",document.getElementsByTagName("head")[0].appendChild(c),context.loginId>0&&$.ajax({url:"/ajax/settings/getThirdPartySettings",type:"POST",success:function(a){a.success&&(b.settingsObjectVersion=a.objectVersion,b.IsPostToFacebookSettingEnabled=a.settings.PublishPlaysToFacebookEnabled=="True"?!0:!1)}})},ChangePostToFacebookSetting:function(a){var b=this;$.ajax({url:"/ajax/settings/thirdPartySettings",type:"POST",dataType:"JSON",data:{PublishPlaysToFacebookEnabled:a,objectVersion:this.settingsObjectVersion},success:function(c){c.success&&(b.IsPostToFacebookSettingEnabled=a,b.settingsObjectVersion=c.objectVersion,a&&!b.FBAssociatedUserId&&Myspace.ThirdPartyHelper.connectThirdParty("facebook",!1,b.connectAccountsCallback))}})},connectAccountsCallback:function(a,b){a||Myspace.Error({text:b.additionalData.msg||"Oops, something went wrong and we were unable to get your connections. Please try again later.",yes:{text:"OK"},no:!1,closeAll:!1})}};a.init(),window.facebookBridge=a})();
(function(){function k(c,h){if(!Myspace.Player.active)return;var i=j("mode"),k="beacon."+(context.features.isPlayerBeaconV3Enabled?"v3":"v2"),l={actionText:c,albumId:b.albumId,artistId:b.artistId,catalogReportedMediaTotalLengthSeconds:isNaN(b.duration)?-1:b.duration,currentPlayheadPositionSeconds:e,deltaPlayElapsedSeconds:f-g,directObjectEntityKeyText:b.entityKey,drawerPinnedIndicator:j("pinned"),drawerVisibleIndicator:a.hasClass("queueOpen"),influencerId:b.influencerId,firstAutoPlayIndicator:d==1,majorModeText:i,mediaId:b.mediaId,mediaReleaseId:b.mediaReleaseId,mediaTypeText:b.isLiveStream?"videoLiveStream":b.mediaType=="audio"?"song":b.mediaType,minorModeText:b.isLiveStream?b.mediaPlayMode:d==1?"firstPlay":undefined,muteEnabledIndicator:j("mute"),originalMediaSourceEntityKeyText:(i=="radio"?j("radioEntity"):b.sourceEntityKey)||undefined,originalStreamStartUtcDateTime:b.streamStartDateTime,pausedIndicator:j("paused"),playerBundleVersionValue:1,playerBufferState:undefined,queueSourceEntityKeyText:b.sourceEntityKey||undefined,radioStationEntityKeyText:i=="radio"?j("radioEntity"):undefined,repeatModeText:j("repeat")||"off",sampleIndicator:!b.isFullLength,shuffleEnabledIndicator:j("shuffled")||!1,totalPlayElapsedSeconds:f,volumeLevelValue:j("volume")};h&&(l.errorType=h.errorType,l.errorText=h.errorText),g=f,comm.send(k,l)}var a=$("body"),b,c,d=0,e=0,f=0,g=0,h=10,i=1,j=new CookieHelper("player");comm.listen({player:{"+loading":function(a){b=a.mediaItem,c=!1,e=a.time,f=0,g=0,i=1,a.mode=="queue"&&d++,k("AttemptLoadStream")},"+started":function(){k("PlayStarted"),comm.send("song.started")},"+paused":function(){k("Pause")},"+time":function(a){e=a.time,f=a.tsl,f>h*i&&(k("PlayedInterval"),i++),!c&&f>=1&&(k("Played1Second"),c=!0)},"+ended":function(){k("FinishedStream")},"+error":function(a){k("Error",a)}}})})();
(function(){function e(a){window.COMSCORE&&COMSCORE.beacon&&(a.c2=d,COMSCORE.beacon(a))}function f(a){e({c1:1,c5:a.isPremium?"02":"06"})}var a,b,c,d="4000002",g={played1Second:function(a){context.features.isComScoreVideoPlayEnabled&&a.mediaType=="video"&&f(a)}},h=comm.own("comscoreBeacon",g);comm.listen({player:{"+loading":function(d){a=d.mediaItem,b=!1,c=0},"+time":function(d){d.time>=0&&d.tsl>=0&&(time=d.time,c=d.tsl),!b&&c>=1&&(context.features.isComScoreVideoPlayEnabled&&a.mediaType=="video"&&f(a),b=!0)}}})})();
var UnityMusicShim=function(){var a={};return a.sendState=function(a){var b=document.createEvent("CustomEvent");b.initEvent("UnityStateEvent",!0,!0),document.body.setAttribute("data-unity-state",JSON.stringify(a)),document.body.dispatchEvent(b,a)},document.body.addEventListener("UnityActionEvent",function(b){var c=JSON.parse(document.body.getAttribute("data-unity-action"));a._callbackObject&&a._callbackObject[c]()}),a.setCallbackObject=function(b){a._callbackObject=b},a.setSupports=function(a){var b=document.createEvent("CustomEvent");b.initEvent("UnitySupportsEvent",!0,!0),document.body.setAttribute("data-unity-supports",JSON.stringify(a)),document.body.dispatchEvent(b,a)},a};(function(){function c(c,d){if(!c)return a.sendState({});b=c.mediaItem,a.sendState({playing:!c.paused,title:b.title,artist:b.artistName,favorite:objectify($("#player .connectButton")).isConnected,albumArt:b.imageUrl})}var a=UnityMusicShim(),b;a.setSupports({playpause:!0,next:!0,previous:!0,favorite:!0}),a.setCallbackObject({pause:function(){comm.send("player.playPause")},next:function(){comm.send("player.next")},previous:function(){comm.send("player.previous")},favorite:function(){$("#player .connectButton").click()}}),comm.listen("connect.status",function(a){if(a.entityKey!=b.entityKey)return;c({mediaItem:b,paused:!1},"player.connect")},!0),comm.listen({player:{"+state":c,"+loaded":c,"+loading":c,"+listChanged":function(a){a.list.length==0&&c()}}})})();
(function(){function a(a){Cookies.player.refresh(),localStorage["ps_"+a]=JSON.stringify(Cookies.player.parsedValues)}function b(a){var b=localStorage["ps_"+a];Cookies.player.values=b?JSON.parse(b):{},Cookies.save(Cookies.player,"."+document.domain,(new Date).addDays(30))}comm.listen("signout",function(){a(context.profileId),b(-1)},!0),comm.listen("signin",function(c){a(-1),b(c.profileId)},!0),localStorage.incognito!=undefined&&(comm.send("player.incognito",localStorage.incognito==1),delete localStorage.incognito)})();
(function(){var a;comm.listen({player:{"+loading":function(b){if(b.mediaItem.isFreeTheTrackSong){a=b.mediaItem,context.pfc!="freeTheTrack"&&comm.send("location.href",a.url),a.allowedPlay==-1&&(a.allowedPlay=15);var c=seofy(a.title+" "+a.mediaId+" "+a.mediaReleaseId);$.get("/ajax/freethetrack/"+c,function(b){b&&!isNaN(b.allowedPlay)&&b.allowedPlay>-1&&($('#queue [data-media-id="'+a.mediaId+'"]').attr("data-allowed-play",b.allowedPlay),a.allowedPlay=b.allowedPlay,comm.send("player.state",{mediaItem:a}))})}else a=undefined},"+time":function(b){var c=a;c&&c.allowedPlay>-1&&b.time>c.allowedPlay&&(comm.send("toasts.new",{html:'<li class="freeTheTrack"><a class="cover" href="'+c.url+'"><img src="'+c.imageUrl+'"></a>'+"<div>You just listened to <em>"+c.allowedPlay+" seconds</em> of "+'<a href="'+c.url+'">'+c.title+"</a> by "+'<a href="'+c.artistUrl+'">'+c.artistName+"</a>"+'<div><button class="primary share">Share to reveal more</button></div>'+"</div></li>",timeout:15e3}),freethetrack=undefined,$("#toasts .freeTheTrack button.share").click(function(){Myspace.User.isLoggedIn?comm.send("superpost",{type:c.type,object:c}):comm.send("share.prompt",{shareUrl:c.url})}),comm.send("queue.remove",'.selected [data-media-id="'+c.mediaId+'"]'))}}})})();
