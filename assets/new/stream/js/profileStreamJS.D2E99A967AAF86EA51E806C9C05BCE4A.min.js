/* stream */var Myspace=Myspace||{};(function(a){Myspace.StreamFilter=function(b,c,d){function j(){b&&b.moveToStart(),i.addClass("shifted"),comm.stopListening("page.esc",k),comm.listen("page.esc",k),comm.send("streamFilters.opening"),g.find("span").html("Hide Filters")}function k(){i.removeClass("shifted"),g.find("span").html("Show Filters"),comm.stopListening("page.esc",k)}function l(){if(!e){var d=h.find(":checkbox");h.find(".close").click(function(){k()}),d.on("click",function(e){var f=a(e.currentTarget);if(f.attr("data-filter-key")=="all")f.prop("checked")?d.not("[data-filter-key='all']").prop("checked","true"):d.not("[data-filter-key='all']").removeAttr("checked");else{h.find(":checkbox[data-filter-key='all']").removeAttr("checked");var g=h.find("input:checked").length;f.prop("checked")&&d.length-g==1?h.find(":checkbox[data-filter-key='all']").prop("checked","true"):g==0&&d.prop("checked","true")}var i=m();if(i&&context.filterStreamUrl){n(i),b&&b.stop();var j=context.filterStreamUrl+i;c(j,undefined,!0,h)}}),h.find("[data-filter-key='all']").closest("li.option").on("mouseenter",function(){a(this).attr("checked")||a("input[type=checkbox]").not(":checked").not("[data-filter-key='all']").closest("li").addClass("hover")}).on("mouseleave",function(){a("input[type=checkbox]").not(":checked").not("[data-filter-key='all']").closest("li.hover").removeClass("hover")}),e=!0}}function m(){var b="",c=0;return h.find(":checkbox[data-filter-key='all']").attr("checked")?b="all":h.find("input:checked").not("[data-filter-key='all']").each(function(d){c>0&&(b+=","),b+=a(this).attr("data-filter-key"),c++}),b}function n(a){comm.send("track",new Tracking("ProfileStreamFilter",a))}var e=!1,f=a("body"),g=a("#streamFilterBtn"),h=a("#streamFilterTray"),i=a("#parallax");g.find("button").unbind("click").click(function(a){return f.hasClass("railOpen")&&comm.send("rightRail.hide"),i.hasClass("shifted")?k():j(),a.stopPropagation(),!1}),l()}})(jQuery);
var Myspace=Myspace||{};(function(a){Myspace.StreamPhotosCarousel=function(){function b(b,c){a.startCarousel({playlistId:b.playlistId,mediaId:b.imageId,focusCommentTab:c,fetchMoreItemsUrl:"/ajax/"+b.username+"/photos/carousel/fetch",carouselSuccessCB:b.carouselSuccessCB,carouselFailCB:b.carouselFailCB})}var a=Myspace.PhotoCarouselLightbox;return{getPhotoDetails:b}}})(jQuery);
var Myspace=Myspace||{};(function(a){function k(){u();var a=c.attr("data-profile-key")||d.find("#profileWidget > div.connectButton").attr("data-entity-key"),b=c.attr("data-profile-name")||d.find("#profileWidget > div.connectButton").attr("data-title");comm.send("superpost",{element:this,profileKey:a,profileName:b})}function l(b){function c(a){var b=a.closest("div.linkItem");a.width()&&a.width()<151?b.removeClass("linkImgCenter"):a.width()&&a.width()>180&&a.css("width","100%"),b.addClass("modify")}b.find("li.songPlays.showMore").each(function(){var b=a(this),c;if(b.data("showSongsInitialized"))return;b.data("showSongsInitialized",!0),c=b.find("article > div > .songsWrap"),c.bind("mousewheel",function(a){b.hasClass("showSongs")&&this.offsetHeight<this.scrollHeight&&a.stopPropagation()}),b.hasClass("fromSource")?(b.find("article > header > div > p > a.moreActivity").click(function(){var d=c.find("ul");d[0].children.length===0&&!d.data("songsLoaded")&&(d.addClass("loading white").data("songsLoaded",!0),a.ajax({url:"/ajax/stream/songList",type:"POST",data:{songIds:b.data("songIds")}}).done(function(a){d.removeClass("loading white").append(a.html),comm.send("page.changed",d)})),b.toggleClass("showSongs")}),b.find("article > div > .media").click(function(a){b.hasClass("showSongs")&&(a.stopPropagation(),a.preventDefault(),b.removeClass("showSongs"))})):b.find("article > div > button.toggleSongsWrap").click(function(){var d=a(this);b.hasClass("showSongs")?(b.removeClass("showSongs"),d.text("Show More"),c.animate({scrollTop:0})):(b.addClass("showSongs"),d.text("Show Less"),c.animate({scrollTop:c.height()}))})}),b.find("div.linkItem:not(.modify) img").each(function(){a(this).load(function(){c(a(this))}),c(a(this))}),b.find("a.systemLink:not(.modify)").each(function(){var b=a(this),c=b.attr("data-id");b.addClass("modify"),b.click(function(a){switch(c){case"post":k();break;case"queue":setTimeout(function(){comm.send("drawer.open","queue")},500);break;case"createmix":comm.send("mix.create");break;case"chat":setTimeout(function(){comm.send("drawer.open","messaging")},500)}return a.stopPropagation(),!1})})}function m(){var b=a("#streamPost .superpost");b.length&&comm.send("superpost",{container:b,profileKey:c.attr("data-profile-key"),profileName:c.attr("data-profile-name")})}function n(){function b(){function e(d){f.endLoading();if(d&&d.streamHtml.trim().length){var e=a(d.streamHtml);e=e.filter("li:not(#streamPost)").filter("li:not(#mashupModule)").filter("li:not(#liveStream)"),c.append(e),c.data("url",b),c.data("page",d.lastActivityDate),o(e),comm.send("page.changed",c)}else f.stop()}var b=c.data("url"),d=c.data("page");if(!d){f.stop();return}!b&&context.streamUrl&&(b=context.streamUrl),f.beginLoading(),s(b,d,e).fail(function(){f.error()})}function d(){var b=c.data("url"),d=c.find("li[data-entity-key]:first time[datetime]"),e=d.attr("data-prev-call-made"),f=d&&d.attr("datetime");if(e)return;!b&&context.streamUrl&&(b=context.streamUrl);if(f){d.attr("data-prev-call-made","true");function g(b){if(b&&b.streamHtml.trim().length){var e=a(b.streamHtml).filter("li:not(#streamPost)").filter("li:not(#mashupModule)").filter("li:not(#liveStream)");e.length>0&&(e.hide().insertBefore(c.find("li[data-entity-key]:first")).fadeIn(2e3),o(e),comm.send("page.changed",c)),d.removeAttr("data-prev-call-made")}}s(b,undefined,g,!0,f).fail(function(){console.log("error occurred, when fetching latest stream. "),d.removeAttr("data-prev-call-made")})}}f=new Myspace.Scroller(e,{content:c},b,d)}function o(a){a=a||c,comm.send("text.limit",{container:a})}function p(a){a.removeClass("loading")}function q(b){var e=b.data("activity-action"),f=b.data("activity-type"),g=b.data("entity-key-for-comment"),h=b.find(".playBtn:first"),i,j,k,l,m;if(e=="share"&&f=="people")k=b.find("article > div:first-of-type").clone(),k.find("p.postText + span").remove(),k.find("p.postText").remove(),j=a("<div class='mediaSquare medium'>").append(k.html());else if(e=="comment"||e=="share"||e=="update"&&(f=="profiledetail"||f=="photo")||e=="post"&&f=="profilestatus")k=b.find("article > header").clone(),k.find("i.x_18_border").remove(),k.find("div.stats.dotted.top").remove(),j=a("<div class='mediaSquare medium'>").append(k.html());if(h&&h.length>0)l=objectify(h);else if(f=="article")i=b.find(".connectButton:first"),l=objectify(i);else if(f=="photo"){var n=b.find("meta"),o=n&&n.attr("content");if(o){l=JSON.parse(o),i=b.find(".connectButton:first");if(i&&i.length>0){var p=i.data();p&&(l=a.extend({},{entityKey:p.entityKey,imageId:p.id,type:"photo",url:p.imageUrl,playlistId:p.playlistId,mixEntityKey:p.mixEntityKey,caption:p.title,captionWithLinks:p.captionWithLinks,mixTitle:p.mixTitle},l))}else m=!0}else m=!0}else if(f=="link"){var q=b.find("meta"),o=q&&q.attr("content");o?(l=JSON.parse(o),l=a.extend({},{entityKey:l.linkEntityKey,type:"link"},l)):m=!0}else m=!0;return m&&(l={entityKey:b.data("entity-key"),type:f}),j&&(l.activityHtml=j),l.commentEntitykey=g,l.influencerId=Myspace.Influencer.getClickInfluencer(b),c.bind("mousewheel",function(){u()}),d.bind("mousewheel",function(){u()}).bind("click",function(b){var c=a(b.target);if(c&&(c.hasClass("stats")||c.parent(".stats").hasClass("stats")))return;u()}),l}function r(b){var c=b.data("entitykey"),d=b.closest("li");c&&a.save({type:"DELETE",dataType:"json",data:{entitykey:c},url:"/ajax/stream/delete",success:function(a){a=="success"&&d&&(b.tip("hide"),d.fadeOut("slow",function(){d.remove()}))}})}function s(b,c,d,e,f){var g,h=context.includeInboundStream;return e&&f?g={activityFromDate:f,firstRequest:!1,includeInboundStream:h}:g={lastActivityDate:c,firstRequest:!c,includeInboundStream:h},a.ajax({url:b,data:g,type:"POST",dataType:"json",success:d})}function t(b,d,e,g){function h(d){var h;e&&(h=a("#liveStream",c),c.html(""));if(d&&d.streamHtml.trim().length){var i=a(d.streamHtml),j=0;h&&h.length?(h.hide(),i.hide().appendTo(c).fadeIn(2e3,function(){var a;c.find("#mashupModule").length?a=c.find("#mashupModule"):c.find("#streamPost").length&&(a=c.find("#streamPost")),h.insertAfter(a).fadeIn(1500)})):c.append(i),c.data("url",b),c.data("page",d.lastActivityDate),comm.send("page.changed",c),m(),e&&f&&(f.reset(),f.moveToStart(),g&&g.removeClass("processing")),setTimeout(function(){o(i)},500);return}if(e){var k=templates["areas/stream/views/helpers/noStreamItem"];k?c.html(require("ejs").compile(k)):c.html(a("<div class='NoResult' >").html("No Stream Data Available.")),g&&g.removeClass("processing")}f.stop()}if(!b)return;g&&g.addClass("processing"),f.beginLoading(),s(b,d,h).fail(function(){f&&f.error(),g&&g.removeClass("processing")})}function u(){b.hasClass("railOpen")&&(v(),comm.send("rightRail.hide"))}function v(){c.unbind("mousewheel").find(".active").removeClass("active"),d.unbind("click mousewheel")}function w(){var a=c.find("li.streamItem").first();if(a.length){var b=q(a),d=context.activityDetail.tabtype;d&&(d=x(b,d),b.options=b.options||{},b.options.closeOnEscape=!1,b.options.closeOnClick=!1,a.addClass("active"),comm.send("rightRail."+d,b))}}function x(a,b){if(a.type.match(/profilestatus/i)||a.type.match(/link/i))a.options={hideTabs:!0,hideConnectButton:!0},b="comments";return b}function y(){m(),E(),!context.activityDetail||!context.activityDetail.singleActivity?n():w(),h=new Myspace.StreamFilter(f,t,c),i=new Myspace.StreamPhotosCarousel,setTimeout(o,500),l(c),comm.listen("page.changed",function(a){a.attr("id")==="stream"&&l(a)},!0),context.initiateTourTip&&(context.homeTraySetting&&context.homeTraySetting.showDiscoverTip?comm.send("show.tooltip",{name:"discover"}):context.homeTraySetting&&context.homeTraySetting.profileTipValue&&comm.send("show.tooltip",{name:"profile"}));if(context.pfc=="home"){var b=a("#featuredArtistTray"),d=b.find(".itemPlaceHolder.livestream .standaloneWTPlayer");b.find("a.playButton > i").click(function(){return comm.send("location.href",a(this).parent().attr("href")),!1}),b.find("a.systemLink:not(.modify)").each(function(){var b=a(this),c=b.attr("data-id");b.addClass("modify"),b.click(function(a){switch(c){case"chat":setTimeout(function(){comm.send("drawer.open","messaging")},500)}return a.stopPropagation(),!1})});var e=b.find(".liveStreamDetails .fullDate[datetime]");if(e.length>0){var g=new Date(e.attr("datetime"));e.text(g.toDateString())}if(b.hasClass("videoAutoPlay")){var d=b.find(".itemPlaceHolder.videoAutoPlay .standaloneWTPlayer");new Myspace.StandalonePlayer("welcomeTrayPlayer",d,context.featuredArtistAutoPlay)}if(b.hasClass("livestream")){var j=b.find(" > .bgImages > img");if(j.length>1){var j=a("#featuredArtistTray > .bgImages"),k=j.find("img");setInterval(function(){var b=j.find("img.viewing"),c=b.next();b.removeClass("viewing"),c.length>0?c.addClass("viewing"):c=k.first().addClass("viewing")},5e3)}Myspace.LiveStreamStandalonePlayer(d,context.featuredArtistLiveStream)}comm.listen("liveStreamCounter.zero",function(a){a.closest(b).length>0&&(b.removeClass("upcoming").addClass("live"),context.featuredArtistLiveStream.isCurrentlyAiring=!0,Myspace.LiveStreamStandalonePlayer(d,context.featuredArtistLiveStream))})}}function C(b,c,d){if(B)b.html(B),d();else{var e={};e.toEntity=c.data("entitykey"),a.ajax({type:"post",url:"/ajax/livestream/mutualConnections",data:e,success:function(a){B='<div class="activityDetail">'+a.content+"</div>",b.html(B),d()}})}}function E(){A.data("popoverInitialized")!=1&&(A.data("popoverInitialized",!0),A.bind("mouseenter.popover",function(){if(D.$activeTarget&&D.$activeTarget[0]===this)return;intentTimer=setTimeout(function(){var b={};A.data("tipVerticalPlacement")&&(b.y=A.data("tipVerticalPlacement")),a("body").hasClass("dragging")||D.show(A,b)},700)}).bind("mouseleave.popover",function(){intentTimer&&clearTimeout(intentTimer)}))}var b=a("body"),c=a("#stream"),d=a("#foreground"),e=a(".horizontalContent"),f,g=a("#superPost"),h,i,j=window.location.href;g.click(function(){k()}),c.on("click",".videoEmbedPlaceholder",function(){var b=a(this),c=b.find("img");comm.send("player.pause"),b.html('<iframe type="text/html" width="'+c.width()+'" height="'+c.height()+'" src="'+(b.data("provider")==="youtube"?"https://www.youtube.com/embed/":"https://player.vimeo.com/video/")+b.data("videoId")+'?autoplay=1" frameborder="0" />')}),c.click(function(b){var c=a(b.target),d=c.hasClass("stats")||c[0].nodeName==="A"&&c.parent().hasClass("stats")?!0:!1;if(c.hasClass("moreActivity"))return!1;d||u();if(d){var e=c.data("action")||"info",f=c.closest(".streamItem"),g=q(f);f.addClass("active"),g&&(g.explicit=!0,e=x(g,e)),comm.send("rightRail."+e,g),b.stopPropagation()}else if(c[0].nodeName==="IMG"&&c.parent().hasClass("photoObject")){var h=c.parent();h.data("imageid")&&(h.addClass("loading"),comm.send("stream.photo",{$photoElement:h,imageId:h.data("imageid"),username:h.data("username"),playlistId:h.data("playlistid"),carouselSuccessCB:function(){p(h)},carouselFailCB:function(){p(h)}})),b.preventDefault(),b.stopPropagation()}else if(c.hasClass("delete")){var i=c.data("entitykey"),j="Do you want to delete ",k=a(".subject",c.parents(".streamItem")).data("entityKey");i.indexOf(",")>0&&(j+="the activities in "),j+="this post?";function l(){comm.send("activity.delete",c)}function m(){return window.setTimeout(function(){var a=i;a.indexOf(",")>0&&(a=a.substr(0,a.indexOf(","))),comm.send("reportAbuse",{type:"post",entityKey:a,userEntityKey:k})},700),!1}if(a(b.target).data("canDelete")==0)return m(),!1;if(a(b.target).data("canReport")==0)return Myspace.Confirm({text:j,yes:{onClick:l}}),!1;Myspace.Confirm({text:"What would you like to do with this post?",yes:{text:"Delete",onClick:l},no:{text:"Report",onClick:m}})}}),comm.listen("activity.delete",r),comm.listen("rightRail.closing",function(){v()}),comm.listen("superpost.onPost",function(b){var d=b&&b.data,e=b&&b.isProfilePost,f=a("#streamPost"),g=e||c.attr("data-show-posted-item")=="true",h;g&&d&&d.success&&(h=a(d.streamHtml).css("display","none").insertBefore(c.children("li[data-entity-key]:first")).fadeIn(2e3),comm.send("page.changed",c),o(h))}),comm.listen("connect>photoComment",function(b){var d=a("div.connectButton[data-entity-key='"+b.entityKey+"']",c).closest("a");d.addClass("loading"),d&&d.length>0&&i.getPhotoDetails({imageId:d.data("imageid"),username:d.data("username"),playlistId:d.data("playlistid"),carouselSuccessCB:function(){p(d)},carouselFailCB:function(){p(d)}},!0)}),comm.listen("stream.photo",function(a){i.getPhotoDetails(a,!1)});var z=a("#popover"),A=a("#liveStream .connectionsWatching .connTotal").parent(),B=null,D=new Myspace.Popover(z,{preRender:C});y()})(jQuery);
(function(a){function e(){d&&(c.tip({trigger:"manual",name:"partiallyAvailable",placement:function(a,b){return this.tip().appendTo(b).css({top:0,left:0,opacity:1,"margin-top":"-34px","margin-left":"-"+this.tip().width()/2+"px"}).addClass("inside top"),!1}}),c.on("click","button",function(c){var d=a(c.target);if(d.hasClass("share"))if(!Myspace.User.isLoggedIn)comm.send("share.prompt",{shareUrl:b.data("songurl")});else{var e=objectify(d.prev());e.artistName=b.data("artistname"),comm.send("superpost",{element:d,type:e.type,object:e})}}),c.css("height",b.data("percentagelefttoreveal")+"%"),c.attr("data-original-title",b.data("formattedallowedplay")+" / "+b.data("formattedduration")).tip("show"),c.find(".tip").css("top","0"))}var b=a(".freeTheTrackContainer"),c=b.find(".partiallyAvailable"),d=b.hasClass("partiallyAvailable");e()})(jQuery);
